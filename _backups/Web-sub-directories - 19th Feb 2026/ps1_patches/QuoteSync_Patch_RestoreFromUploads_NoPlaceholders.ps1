# =========================================
# QuoteSync - Restore working files from uploaded contents (NO placeholders)
# Run from: PS C:\Github\QuoteSync\web\ps1_patches>
# Writes:
#   - src\App.tsx
#   - src\components\GridEditor.tsx
#   - src\main.tsx
# Creates timestamped backups in: C:\Github\QuoteSync\web\_backups
# =========================================

$ErrorActionPreference = "Stop"

function Ok($m){ Write-Host "OK: $m" -ForegroundColor Green }
function Fail($m){ Write-Host "ERROR: $m" -ForegroundColor Red; throw $m }

# Resolve web root from this script's folder (..)
$scriptDir = Split-Path -Parent $MyInvocation.MyCommand.Path
if (-not $scriptDir) { $scriptDir = (Get-Location).Path }
$webRoot = (Resolve-Path (Join-Path $scriptDir "..")).Path

Write-Host ("Run directory: " + (Get-Location).Path)
Write-Host ("Working directory: " + $webRoot)

if (-not (Test-Path $webRoot)) { Fail "Web root not found: $webRoot" }
Set-Location $webRoot

function Ensure-Dir($p) {
  if (-not (Test-Path $p)) {
    New-Item -ItemType Directory -Force -Path $p | Out-Null
  }
}

function Backup-File($absPath, $relLabel) {
  $backupDir = Join-Path $webRoot "_backups"
  Ensure-Dir $backupDir
  if (-not (Test-Path $absPath)) { Fail "Missing file to backup: $absPath" }
  $stamp = Get-Date -Format "yyyyMMdd_HHmmss"
  $bak = Join-Path $backupDir ("0.1.bak" -f $relLabel, $stamp)
  Copy-Item -Force $absPath $bak
  Ok ("Backup written: " + (Split-Path -Leaf $bak))
}

function Write-AtomicUtf8FromBase64($targetAbs, $b64) {
  if ([string]::IsNullOrWhiteSpace($b64)) { Fail "Base64 payload is empty." }
  # Remove any whitespace/newlines just in case
  $b64Clean = ($b64 -replace "\s","")
  $bytes = [Convert]::FromBase64String($b64Clean)

  $dir = Split-Path -Parent $targetAbs
  Ensure-Dir $dir

  $tmp = Join-Path $dir ((Split-Path -Leaf $targetAbs) + ".__tmp__")
  [System.IO.File]::WriteAllBytes($tmp, $bytes)
  Move-Item -Force $tmp $targetAbs
}

# Targets
$appTarget  = Join-Path $webRoot "src\App.tsx"
$gridTarget = Join-Path $webRoot "src\components\GridEditor.tsx"
$mainTarget = Join-Path $webRoot "src\main.tsx"

# Backups
Backup-File $appTarget  "App.tsx"
Backup-File $gridTarget "GridEditor.tsx"
Backup-File $mainTarget "main.tsx"

# --- Embedded file contents (base64, UTF-8) ---
$b64App = @"
aW1wb3J0IFJlYWN0LCB7IHVzZUVmZmVjdCwgdXNlTWVtbywgdXNlU3RhdGUgfSBmcm9tICJyZWFjdCI7CmltcG9ydCBHcmlkRWRpdG9yIGZyb20gIi4vY29tcG9uZW50cy9HcmlkRWRpdG9yIjsKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT0KICAgVHlwZXMKPT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKdHlwZSBNZW51S2V5ID0KICB8ICJjdXN0b21lcnNfYnVzaW5lc3MiCiAgfCAiY3VzdG9tZXJzX2luZGl2aWR1YWwiCiAgfCAicHJvamVjdF9wcmVmZXJlbmNlcyIKICB8ICJhZGRyZXNzX2RhdGFiYXNlIgogIHwgInJlcG9ydHMiCiAgfCAiY2FkX2RyYXdpbmciCiAgfCAicmVtb3RlX3N1cHBvcnQiOwoKdHlwZSBDbGllbnRUeXBlID0gIkJ1c2luZXNzIiB8ICJJbmRpdmlkdWFsIjsKdHlwZSBFc3RpbWF0ZVN0YXR1cyA9ICJEcmFmdCIgfCAiQ29tcGxldGVkIjsKCnR5cGUgUHJvZHVjdFR5cGUgPQogIHwgInVQVkMiCiAgfCAidVBWQyBBbHUgQ2xhZCIKICB8ICJUaW1iZXIiCiAgfCAiVGltYmVyIEFsdW1pbml1bSBDbGFkIgogIHwgIkFsdW1pbml1bSIKICB8ICJTdGVlbCI7Cgp0eXBlIFZpZXcgPQogIHwgImN1c3RvbWVycyIKICB8ICJlc3RpbWF0ZV9waWNrZXIiCiAgfCAiZXN0aW1hdGVfZGVmYXVsdHMiCiAgfCAiZXN0aW1hdGVfd29ya3NwYWNlIjsKCnR5cGUgQ2xpZW50ID0gewogIGlkOiBzdHJpbmc7CiAgdHlwZTogQ2xpZW50VHlwZTsKICBjbGllbnRSZWY6IHN0cmluZzsgLy8gRUYtQ0wtMDAxCiAgY2xpZW50TmFtZTogc3RyaW5nOwogIGVtYWlsOiBzdHJpbmc7CiAgbW9iaWxlOiBzdHJpbmc7CiAgaG9tZTogc3RyaW5nOwoKICBwcm9qZWN0TmFtZTogc3RyaW5nOwogIHByb2plY3RBZGRyZXNzOiBzdHJpbmc7CiAgaW52b2ljZUFkZHJlc3M6IHN0cmluZzsKCiAgYnVzaW5lc3NOYW1lPzogc3RyaW5nOwogIGNvbnRhY3RQZXJzb24/OiBzdHJpbmc7CgogIGVzdGltYXRlczogRXN0aW1hdGVbXTsKfTsKCnR5cGUgRXN0aW1hdGVEZWZhdWx0cyA9IHsKICBzdXBwbGllcjogc3RyaW5nOwogIHByb2R1Y3RUeXBlOiBQcm9kdWN0VHlwZTsKICBwcm9kdWN0OiBzdHJpbmc7CgogIHdvb2RUeXBlOiBzdHJpbmc7CgogIGV4dGVybmFsRmluaXNoOiBzdHJpbmc7CiAgaW50ZXJuYWxGaW5pc2g6IHN0cmluZzsKCiAgaGluZ2VUeXBlOiAiQ29uY2VhbGVkIiB8ICJFeHBvc2VkIDEzMEtnIiB8ICJFeHBvc2VkIDE4MEtnIjsKCiAgZ2xhc3NUeXBlOiAiRG91YmxlIiB8ICJUcmlwbGUiOwogIHVnVmFsdWU6IHN0cmluZzsgLy8gcmVuYW1lZCBmcm9tIFUgdG8gVWcKICBnVmFsdWU6IHN0cmluZzsKCiAgd2luZG93SGFuZGxlVHlwZTogIlR5cGUgMSIgfCAiVHlwZSAyIiB8ICJUeXBlIDMiIHwgIlR5cGUgNCIgfCAiVHlwZSA1IjsKCiAgLy8gZG9vci1vbmx5CiAgZG9vck11bHRpcG9pbnRMb2NraW5nOiBib29sZWFuOwogIGVsZWN0cmljYWxPcGVyYXRpb246IGJvb2xlYW47CiAgZGF5TGF0Y2g6IGJvb2xlYW47CgogIC8vIGFjY2Vzc29yaWVzCiAgaW50ZXJuYWxDaWxsUmVxdWlyZWQ6IGJvb2xlYW47CiAgZXh0ZXJuYWxTaWxsUmVxdWlyZWQ6IGJvb2xlYW47CiAgY2lsbERlcHRoTW06IG51bWJlcjsKICBjaWxsRW5kQ2FwVHlwZTogIkNsYWRkaW5nL1JlbmRlciBFbmQgQ2FwIiB8ICJCcmljayBUeXBlIEVuZCBDYXAiOwoKICBmcmFtZUV4dExlZnRNbTogbnVtYmVyOwogIGZyYW1lRXh0UmlnaHRNbTogbnVtYmVyOwogIGZyYW1lRXh0VG9wTW06IG51bWJlcjsKICBmcmFtZUV4dEJvdHRvbU1tOiBudW1iZXI7CgogIHN1blByb3RlY3Rpb25SZXF1aXJlZDogYm9vbGVhbjsKICBzdW5Qcm90ZWN0aW9uVHlwZTogIlNodXR0ZXJzIiB8ICJSb2xsZXIgYmxpbmRzIiB8ICJWZW5ldGlhbiBibGluZHMgKGV4dGVybmFsKSIgfCAiVmVuZXRpYW4gYmxpbmRzIChpbnRlcm5hbCkiOwp9OwoKdHlwZSBFc3RpbWF0ZSA9IHsKICBpZDogc3RyaW5nOwogIGVzdGltYXRlUmVmOiBzdHJpbmc7CiAgYmFzZUVzdGltYXRlUmVmOiBzdHJpbmc7CiAgcmV2aXNpb25ObzogbnVtYmVyOwogIHN0YXR1czogRXN0aW1hdGVTdGF0dXM7CiAgZGVmYXVsdHM6IEVzdGltYXRlRGVmYXVsdHM7CiAgcG9zaXRpb25zOiBQb3NpdGlvbltdOwp9OwoKdHlwZSBQb3NpdGlvbiA9IHsKICBpZDogc3RyaW5nOwogIHBvc2l0aW9uUmVmOiBzdHJpbmc7CiAgcXR5OiBudW1iZXI7CiAgcm9vbU5hbWU6IHN0cmluZzsKCiAgd2lkdGhNbTogbnVtYmVyOwogIGhlaWdodE1tOiBudW1iZXI7CiAgZmllbGRzWDogbnVtYmVyOwogIGZpZWxkc1k6IG51bWJlcjsKCiAgaW5zZXJ0aW9uOiBzdHJpbmc7CiAgY2VsbEluc2VydGlvbnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz47IC8vIGtleTogXCJjb2wscm93XCIKICBjb2xXaWR0aHNNbT86IG51bWJlcltdOwogIHJvd0hlaWdodHNNbT86IG51bWJlcltdOwoKICBwb3NpdGlvblR5cGU6ICJXaW5kb3ciIHwgIkRvb3IiOwoKICAvLyBwZXItcG9zaXRpb24gb3ZlcnJpZGVzIChvcHRpb25hbCkKICB1c2VFc3RpbWF0ZURlZmF1bHRzOiBib29sZWFuOwogIG92ZXJyaWRlczogUGFydGlhbDxFc3RpbWF0ZURlZmF1bHRzPjsKfTsKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT0KICAgSGVscGVycwo9PT09PT09PT09PT09PT09PT09PT09PT09ICovCgpmdW5jdGlvbiB1aWQoKSB7CiAgcmV0dXJuIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnNsaWNlKDIpICsgRGF0ZS5ub3coKS50b1N0cmluZygxNik7Cn0KCmZ1bmN0aW9uIHBhZDMobjogbnVtYmVyKSB7CiAgY29uc3QgcyA9IFN0cmluZyhuKTsKICByZXR1cm4gcy5sZW5ndGggPj0gMyA/IHMgOiAiMCIucmVwZWF0KDMgLSBzLmxlbmd0aCkgKyBzOwp9CgpmdW5jdGlvbiBrZXlGb3JDZWxsKGNvbDogbnVtYmVyLCByb3c6IG51bWJlcikgewogIHJldHVybiBgJHtjb2x9LCR7cm93fWA7Cn0KCmZ1bmN0aW9uIG5vcm1hbGl6ZUNlbGxJbnNlcnRpb25zKAogIGZpZWxkc1g6IG51bWJlciwKICBmaWVsZHNZOiBudW1iZXIsCiAgZXhpc3Rpbmc6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gfCB1bmRlZmluZWQsCiAgZmFsbGJhY2s6IHN0cmluZwopIHsKICBjb25zdCBvdXQ6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTsKICBmb3IgKGxldCByID0gMDsgciA8IGZpZWxkc1k7IHIrKykgewogICAgZm9yIChsZXQgYyA9IDA7IGMgPCBmaWVsZHNYOyBjKyspIHsKICAgICAgY29uc3QgayA9IGtleUZvckNlbGwoYywgcik7CiAgICAgIG91dFtrXSA9IGV4aXN0aW5nPy5ba10gPz8gZmFsbGJhY2s7CiAgICB9CiAgfQogIHJldHVybiBvdXQ7Cn0KCmZ1bmN0aW9uIGNsYW1wTnVtKG46IG51bWJlciwgbWluOiBudW1iZXIsIG1heDogbnVtYmVyKSB7CiAgcmV0dXJuIE1hdGgubWF4KG1pbiwgTWF0aC5taW4obWF4LCBuKSk7Cn0KCmZ1bmN0aW9uIG5leHRDbGllbnRSZWYobjogbnVtYmVyKSB7CiAgcmV0dXJuIGBFRi1DTC0ke3BhZDMobil9YDsKfQoKY29uc3QgREVGQVVMVF9FU1RJTUFURV9SRUZfUFJFRklYID0gIkVGLUVTVCI7CgovKioKICogRXN0aW1hdGUgcmVmZXJlbmNlIHByZWZpeC4KICogRGVmYXVsdCBhbGlnbnMgdG8gRUYtRVNULVlZWVktIyMjLgogKiBGdXR1cmU6IGV4cG9zZSBhcyBhbiBBZG1pbiBzZXR0aW5nLgogKi8KZnVuY3Rpb24gZ2V0RXN0aW1hdGVSZWZQcmVmaXgoKSB7CiAgdHJ5IHsKICAgIGNvbnN0IHYgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgicXVvdGVzeW5jLmVzdGltYXRlUmVmUHJlZml4Iik7CiAgICBpZiAodiAmJiAvXltBLVowLTktXSskLy50ZXN0KHYpKSByZXR1cm4gdjsKICB9IGNhdGNoIHsKICAgIC8vIGlnbm9yZSBzdG9yYWdlIGVycm9ycyAocHJpdmF0ZSBtb2RlIC8gYmxvY2tlZCkKICB9CiAgcmV0dXJuIERFRkFVTFRfRVNUSU1BVEVfUkVGX1BSRUZJWDsKfQoKZnVuY3Rpb24gbmV4dEVzdGltYXRlQmFzZVJlZih5ZWFyOiBudW1iZXIsIG46IG51bWJlcikgewogIHJldHVybiBgJHtnZXRFc3RpbWF0ZVJlZlByZWZpeCgpfS0ke3llYXJ9LSR7cGFkMyhuKX1gOwp9CgpmdW5jdGlvbiBlc3RpbWF0ZVJlZldpdGhSZXZpc2lvbihiYXNlOiBzdHJpbmcsIHJldmlzaW9uTm86IG51bWJlcikgewogIGlmIChyZXZpc2lvbk5vIDw9IDApIHJldHVybiBiYXNlOwogIHJldHVybiBgJHtiYXNlfS0ke1N0cmluZyhyZXZpc2lvbk5vKS5wYWRTdGFydCgyLCAiMCIpfWA7Cn0KCmNvbnN0IFBST0RVQ1RfVFlQRVM6IFByb2R1Y3RUeXBlW10gPSBbInVQVkMiLCAidVBWQyBBbHUgQ2xhZCIsICJUaW1iZXIiLCAiVGltYmVyIEFsdW1pbml1bSBDbGFkIiwgIkFsdW1pbml1bSIsICJTdGVlbCJdOwoKdHlwZSBTdXBwbGllckNhdGFsb2cgPSB7CiAgbmFtZTogc3RyaW5nOwogIHByb2R1Y3RzQnlUeXBlOiBQYXJ0aWFsPFJlY29yZDxQcm9kdWN0VHlwZSwgc3RyaW5nW10+PjsKfTsKCmNvbnN0IFNVUFBMSUVSUzogU3VwcGxpZXJDYXRhbG9nW10gPSBbCiAgewogICAgbmFtZTogIkludGVybm9ybSIsCiAgICBwcm9kdWN0c0J5VHlwZTogewogICAgICB1UFZDOiBbIktGNTIwIiwgIktGNDEwIiwgIktGMzIwIiwgIktGMzEwIl0sCiAgICAgICJ1UFZDIEFsdSBDbGFkIjogWyJLVjQ0MCIsICJLVjM1MCIsICJLRjUyMCIsICJLRjMxMCIsICJLRjMyMCJdLAogICAgICAiVGltYmVyIEFsdW1pbml1bSBDbGFkIjogWyJIVjQ1MCIsICJIRjQxMCIsICJIRjUxMCIsICJIVDQxMCIsICJIVDQwMCIsICJIVDMxMCIsICJIUzMzMCJdLAogICAgICBBbHVtaW5pdW06IFsiQVQ1MDAiLCAiQVQ1MTAiLCAiQVQ1MjAiLCAiQVQ1MzAiLCAiQVQ1NDAiXSwKICAgIH0sCiAgfSwKICB7CiAgICBuYW1lOiAiRWtvIE9rbmEiLAogICAgcHJvZHVjdHNCeVR5cGU6IHsKICAgICAgdVBWQzogWyJTeW5lZ28iLCAiSWRlYWwgNDAwMCIsICJJZGVhbCA3MCIsICJCbHVFdm9sdXRpb24gODIiLCAiSWRlYWwgODAwMCIsICJOb3JkbGluZSIsICJTOTAwMCJdLAogICAgICBUaW1iZXI6IFsiTmF0dXJvIDY4IiwgIk5hdHVybyA4MCIsICJOYXR1cm8gOTIiXSwKICAgICAgIlRpbWJlciBBbHVtaW5pdW0gQ2xhZCI6IFsiTmF0dXJvIDY4IEFsdSIsICJOYXR1cm8gODAgQWx1Il0sCiAgICAgIEFsdW1pbml1bTogWyJNQi03OU4iLCAiTUItODYgQ2FzZW1lbnQiLCAiTUItMTA0IFBhc3NpdmUiLCAiR2VuZXNpcyIsICJJbXBlcmlhbCJdLAogICAgICBTdGVlbDogWyJVbmljbyBYUyIsICJQcmVzdG8iLCAiVW5pY28iXSwKICAgIH0sCiAgfSwKXTsKCmZ1bmN0aW9uIGdldFN1cHBsaWVyKG5hbWU6IHN0cmluZykgewogIHJldHVybiBTVVBQTElFUlMuZmluZCgocykgPT4gcy5uYW1lID09PSBuYW1lKSA/PyBudWxsOwp9CgpmdW5jdGlvbiBhbGxQcm9kdWN0c0ZvclN1cHBsaWVyKG5hbWU6IHN0cmluZykgewogIGNvbnN0IHMgPSBnZXRTdXBwbGllcihuYW1lKTsKICBpZiAoIXMpIHJldHVybiBbXTsKICBjb25zdCBhbGwgPSBPYmplY3QudmFsdWVzKHMucHJvZHVjdHNCeVR5cGUpLmZsYXQoKS5maWx0ZXIoQm9vbGVhbikgYXMgc3RyaW5nW107CiAgcmV0dXJuIEFycmF5LmZyb20obmV3IFNldChhbGwpKS5zb3J0KChhLCBiKSA9PiBhLmxvY2FsZUNvbXBhcmUoYikpOwp9CgpmdW5jdGlvbiBmaXJzdFByb2R1Y3RGb3JTdXBwbGllcihuYW1lOiBzdHJpbmcpIHsKICByZXR1cm4gYWxsUHJvZHVjdHNGb3JTdXBwbGllcihuYW1lKVswXSA/PyAiIjsKfQoKY29uc3QgV09PRF9UWVBFUyA9IFsiRmluZ2VyIEpvaW50ZWQgUGluZSIsICJQaW5lIiwgIlNwcnVjZSIsICJMYXJjaCIsICJPYWsiLCAiQWNjb3lhIiwgIk1lcmFudGkiLCAiTWFob2dhbnkiXSBhcyBjb25zdDsKCmZ1bmN0aW9uIGlzVGltYmVyUHJvZHVjdFR5cGUodDogUHJvZHVjdFR5cGUpIHsKICByZXR1cm4gdCA9PT0gIlRpbWJlciIgfHwgdCA9PT0gIlRpbWJlciBBbHVtaW5pdW0gQ2xhZCI7Cn0KCi8qIC0tLSBmaW5pc2hlczogdHlwZWFoZWFkIGRyb3Bkb3duIHZpYSBkYXRhbGlzdCAtLS0gKi8KY29uc3QgRklOSVNIRVNfQllfVFlQRTogUmVjb3JkPFByb2R1Y3RUeXBlLCB7IGV4dGVybmFsOiBzdHJpbmdbXTsgaW50ZXJuYWw6IHN0cmluZ1tdIH0+ID0gewogIHVQVkM6IHsgZXh0ZXJuYWw6IFsiRXh0IFR5cGUgMSIsICJFeHQgVHlwZSAyIl0sIGludGVybmFsOiBbIkludCBUeXBlIDEiLCAiSW50IFR5cGUgMiJdIH0sCiAgInVQVkMgQWx1IENsYWQiOiB7IGV4dGVybmFsOiBbIkV4dCBUeXBlIDEiLCAiRXh0IFR5cGUgMiJdLCBpbnRlcm5hbDogWyJJbnQgVHlwZSAxIiwgIkludCBUeXBlIDIiXSB9LAogIFRpbWJlcjogeyBleHRlcm5hbDogWyJFeHQgVHlwZSAxIiwgIkV4dCBUeXBlIDIiXSwgaW50ZXJuYWw6IFsiSW50IFR5cGUgMSIsICJJbnQgVHlwZSAyIl0gfSwKICAiVGltYmVyIEFsdW1pbml1bSBDbGFkIjogeyBleHRlcm5hbDogWyJFeHQgVHlwZSAxIiwgIkV4dCBUeXBlIDIiXSwgaW50ZXJuYWw6IFsiSW50IFR5cGUgMSIsICJJbnQgVHlwZSAyIl0gfSwKICBBbHVtaW5pdW06IHsgZXh0ZXJuYWw6IFsiRXh0IFR5cGUgMSIsICJFeHQgVHlwZSAyIl0sIGludGVybmFsOiBbIkludCBUeXBlIDEiLCAiSW50IFR5cGUgMiJdIH0sCiAgU3RlZWw6IHsgZXh0ZXJuYWw6IFsiRXh0IFR5cGUgMSIsICJFeHQgVHlwZSAyIl0sIGludGVybmFsOiBbIkludCBUeXBlIDEiLCAiSW50IFR5cGUgMiJdIH0sCn07Cgpjb25zdCBISU5HRV9UWVBFUzogRXN0aW1hdGVEZWZhdWx0c1siaGluZ2VUeXBlIl1bXSA9IFsiQ29uY2VhbGVkIiwgIkV4cG9zZWQgMTMwS2ciLCAiRXhwb3NlZCAxODBLZyJdOwoKY29uc3QgVUdfRE9VQkxFID0gWyIxLjEiLCAiMS4yIl07CmNvbnN0IFVHX1RSSVBMRSA9IFsiMC40IiwgIjAuNSIsICIwLjYiLCAiMC43IiwgIjAuOCJdOwoKY29uc3QgSEFORExFX1RZUEVTOiBFc3RpbWF0ZURlZmF1bHRzWyJ3aW5kb3dIYW5kbGVUeXBlIl1bXSA9IFsiVHlwZSAxIiwgIlR5cGUgMiIsICJUeXBlIDMiLCAiVHlwZSA0IiwgIlR5cGUgNSJdOwoKY29uc3QgU1VOX1BST1RFQ1RJT046IEVzdGltYXRlRGVmYXVsdHNbInN1blByb3RlY3Rpb25UeXBlIl1bXSA9IFsKICAiU2h1dHRlcnMiLAogICJSb2xsZXIgYmxpbmRzIiwKICAiVmVuZXRpYW4gYmxpbmRzIChleHRlcm5hbCkiLAogICJWZW5ldGlhbiBibGluZHMgKGludGVybmFsKSIsCl07CgpmdW5jdGlvbiBidWlsZENpbGxEZXB0aE9wdGlvbnMoKTogbnVtYmVyW10gewogIGNvbnN0IG91dDogbnVtYmVyW10gPSBbXTsKICBmb3IgKGxldCB2ID0gNTA7IHYgPD0gMTEwOyB2ICs9IDIwKSBvdXQucHVzaCh2KTsKICBmb3IgKGxldCB2ID0gMTMwOyB2IDw9IDIxMDsgdiArPSAxNSkgb3V0LnB1c2godik7CiAgZm9yIChsZXQgdiA9IDIzMDsgdiA8PSA0MDA7IHYgKz0gMjApIG91dC5wdXNoKHYpOwogIC8vIGVuc3VyZSAyMTAgaW5jbHVkZWQgYWxyZWFkeTsgZW5zdXJlIDIzMCsgaXMgY29ycmVjdCBzdGVwIGZyb20gIjIxMCB1cCB0byA0MDAgaW4gMjBtbSIKICAvLyAod2Ugc3RhcnQgYXQgMjMwIHRvIGF2b2lkIGR1cGxpY2F0aW5nIDIxMCBhbmQgcHJlc2VydmUgMjBtbSBpbmNyZW1lbnRzKQogIHJldHVybiBvdXQ7Cn0KCmNvbnN0IENJTExfREVQVEhTID0gYnVpbGRDaWxsRGVwdGhPcHRpb25zKCk7CmNvbnN0IEZSQU1FX0VYVFMgPSBbMCwgMjUsIDUwLCA3NSwgMTAwXTsKCmZ1bmN0aW9uIG1ha2VEZWZhdWx0RXN0aW1hdGVEZWZhdWx0cygpOiBFc3RpbWF0ZURlZmF1bHRzIHsKICBjb25zdCBzdXBwbGllciA9IFNVUFBMSUVSU1swXT8ubmFtZSA/PyAiIjsKICBjb25zdCBwcm9kdWN0VHlwZTogUHJvZHVjdFR5cGUgPSAidVBWQyI7CiAgY29uc3QgcHJvZHVjdCA9IHN1cHBsaWVyID8gZmlyc3RQcm9kdWN0Rm9yU3VwcGxpZXIoc3VwcGxpZXIpIDogIiI7CiAgcmV0dXJuIHsKICAgIHN1cHBsaWVyLAogICAgcHJvZHVjdFR5cGUsCiAgICBwcm9kdWN0LAoKICAgIHdvb2RUeXBlOiBXT09EX1RZUEVTWzBdLAoKICAgIGV4dGVybmFsRmluaXNoOiAiIiwKICAgIGludGVybmFsRmluaXNoOiAiIiwKCiAgICBoaW5nZVR5cGU6ICJDb25jZWFsZWQiLAoKICAgIGdsYXNzVHlwZTogIkRvdWJsZSIsCiAgICB1Z1ZhbHVlOiAiMS4xIiwKICAgIGdWYWx1ZTogIjAuNTMiLAoKICAgIHdpbmRvd0hhbmRsZVR5cGU6ICJUeXBlIDEiLAoKICAgIGRvb3JNdWx0aXBvaW50TG9ja2luZzogZmFsc2UsCiAgICBlbGVjdHJpY2FsT3BlcmF0aW9uOiBmYWxzZSwKICAgIGRheUxhdGNoOiBmYWxzZSwKCiAgICBpbnRlcm5hbENpbGxSZXF1aXJlZDogZmFsc2UsCiAgICBleHRlcm5hbFNpbGxSZXF1aXJlZDogZmFsc2UsCiAgICBjaWxsRGVwdGhNbTogNTAsCiAgICBjaWxsRW5kQ2FwVHlwZTogIkNsYWRkaW5nL1JlbmRlciBFbmQgQ2FwIiwKCiAgICBmcmFtZUV4dExlZnRNbTogMCwKICAgIGZyYW1lRXh0UmlnaHRNbTogMCwKICAgIGZyYW1lRXh0VG9wTW06IDAsCiAgICBmcmFtZUV4dEJvdHRvbU1tOiAwLAoKICAgIHN1blByb3RlY3Rpb25SZXF1aXJlZDogZmFsc2UsCiAgICBzdW5Qcm90ZWN0aW9uVHlwZTogIlNodXR0ZXJzIiwKICB9Owp9Cgpjb25zdCBERUZBVUxUX0NVU1RPTUVSX0FERFJFU1MgPSBbIjQgR2xlYmUgUm9hZCIsICJDb3dkZW5iZWF0aCIsICJGaWZlIiwgIktZNCA5RkEiXS5qb2luKCJcbiIpOwoKZnVuY3Rpb24gbWFrZURlZmF1bHRDbGllbnRzKCk6IENsaWVudFtdIHsKICByZXR1cm4gWwogICAgewogICAgICBpZDogdWlkKCksCiAgICAgIHR5cGU6ICJCdXNpbmVzcyIsCiAgICAgIGNsaWVudFJlZjogbmV4dENsaWVudFJlZigxKSwKICAgICAgY2xpZW50TmFtZTogIkVjb2ZlbnN0ZXIgTHRkIiwKICAgICAgYnVzaW5lc3NOYW1lOiAiRWNvZmVuc3RlciBMdGQiLAogICAgICBjb250YWN0UGVyc29uOiAiIiwKICAgICAgZW1haWw6ICIiLAogICAgICBtb2JpbGU6ICIwNzg4MiA4MDkgNDUzIiwKICAgICAgaG9tZTogIiIsCiAgICAgIHByb2plY3ROYW1lOiAiIiwKICAgICAgcHJvamVjdEFkZHJlc3M6IERFRkFVTFRfQ1VTVE9NRVJfQUREUkVTUywKICAgICAgaW52b2ljZUFkZHJlc3M6IERFRkFVTFRfQ1VTVE9NRVJfQUREUkVTUywKICAgICAgZXN0aW1hdGVzOiBbXSwKICAgIH0sCiAgICB7CiAgICAgIGlkOiB1aWQoKSwKICAgICAgdHlwZTogIkluZGl2aWR1YWwiLAogICAgICBjbGllbnRSZWY6IG5leHRDbGllbnRSZWYoMiksCiAgICAgIGNsaWVudE5hbWU6ICJDcmFpZyBGZXJndXNvbiIsCiAgICAgIGJ1c2luZXNzTmFtZTogIiIsCiAgICAgIGNvbnRhY3RQZXJzb246ICIiLAogICAgICBlbWFpbDogIiIsCiAgICAgIG1vYmlsZTogIjA3ODgyIDgwOSA0NTMiLAogICAgICBob21lOiAiIiwKICAgICAgcHJvamVjdE5hbWU6ICIiLAogICAgICBwcm9qZWN0QWRkcmVzczogREVGQVVMVF9DVVNUT01FUl9BRERSRVNTLAogICAgICBpbnZvaWNlQWRkcmVzczogREVGQVVMVF9DVVNUT01FUl9BRERSRVNTLAogICAgICBlc3RpbWF0ZXM6IFtdLAogICAgfSwKICBdOwp9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09CiAgIFVJIHByaW1pdGl2ZXMgKGlubGluZSBvbmx5KQo9PT09PT09PT09PT09PT09PT09PT09PT09ICovCgpmdW5jdGlvbiBDYXJkKHsgY2hpbGRyZW4sIHN0eWxlIH06IHsgY2hpbGRyZW46IFJlYWN0LlJlYWN0Tm9kZTsgc3R5bGU/OiBSZWFjdC5DU1NQcm9wZXJ0aWVzIH0pIHsKICByZXR1cm4gKAogICAgPGRpdgogICAgICBzdHlsZT17ewogICAgICAgIGJvcmRlclJhZGl1czogMTgsCiAgICAgICAgYm9yZGVyOiAiMXB4IHNvbGlkICNlNGU0ZTciLAogICAgICAgIGJhY2tncm91bmQ6ICIjZmZmIiwKICAgICAgICBwYWRkaW5nOiAxNiwKICAgICAgICBib3hTaGFkb3c6ICIwIDFweCAycHggcmdiYSgwLDAsMCwuMDYpIiwKICAgICAgICAuLi5zdHlsZSwKICAgICAgfX0KICAgID4KICAgICAge2NoaWxkcmVufQogICAgPC9kaXY+CiAgKTsKfQoKZnVuY3Rpb24gSDIoeyBjaGlsZHJlbiB9OiB7IGNoaWxkcmVuOiBSZWFjdC5SZWFjdE5vZGUgfSkgewogIHJldHVybiA8aDIgc3R5bGU9e3sgZm9udFNpemU6IDE2LCBtYXJnaW46IDAsIGZvbnRXZWlnaHQ6IDgwMCwgY29sb3I6ICIjMTgxODFiIiB9fT57Y2hpbGRyZW59PC9oMj47Cn0KCmZ1bmN0aW9uIEgzKHsgY2hpbGRyZW4gfTogeyBjaGlsZHJlbjogUmVhY3QuUmVhY3ROb2RlIH0pIHsKICByZXR1cm4gPGgzIHN0eWxlPXt7IGZvbnRTaXplOiAxNCwgbWFyZ2luOiAwLCBmb250V2VpZ2h0OiA4MDAsIGNvbG9yOiAiIzE4MTgxYiIgfX0+e2NoaWxkcmVufTwvaDM+Owp9CgpmdW5jdGlvbiBTbWFsbCh7IGNoaWxkcmVuIH06IHsgY2hpbGRyZW46IFJlYWN0LlJlYWN0Tm9kZSB9KSB7CiAgcmV0dXJuIDxkaXYgc3R5bGU9e3sgZm9udFNpemU6IDEyLCBjb2xvcjogIiM3MTcxN2EiIH19PntjaGlsZHJlbn08L2Rpdj47Cn0KCmZ1bmN0aW9uIEJ1dHRvbih7CiAgY2hpbGRyZW4sCiAgb25DbGljaywKICB2YXJpYW50ID0gInByaW1hcnkiLAogIGRpc2FibGVkLAogIHN0eWxlLAp9OiB7CiAgY2hpbGRyZW46IFJlYWN0LlJlYWN0Tm9kZTsKICBvbkNsaWNrPzogKCkgPT4gdm9pZDsKICB2YXJpYW50PzogInByaW1hcnkiIHwgInNlY29uZGFyeSI7CiAgZGlzYWJsZWQ/OiBib29sZWFuOwogIHN0eWxlPzogUmVhY3QuQ1NTUHJvcGVydGllczsKfSkgewogIGNvbnN0IGlzUHJpbWFyeSA9IHZhcmlhbnQgPT09ICJwcmltYXJ5IjsKICByZXR1cm4gKAogICAgPGJ1dHRvbgogICAgICB0eXBlPSJidXR0b24iCiAgICAgIGRpc2FibGVkPXshIWRpc2FibGVkfQogICAgICBvbkNsaWNrPXtvbkNsaWNrfQogICAgICBzdHlsZT17ewogICAgICAgIGJvcmRlclJhZGl1czogMTgsCiAgICAgICAgYm9yZGVyOiBpc1ByaW1hcnkgPyAibm9uZSIgOiAiMXB4IHNvbGlkICNlNGU0ZTciLAogICAgICAgIGJhY2tncm91bmQ6IGlzUHJpbWFyeSA/ICIjMTgxODFiIiA6ICIjZmZmIiwKICAgICAgICBjb2xvcjogaXNQcmltYXJ5ID8gIiNmZmYiIDogIiMzZjNmNDYiLAogICAgICAgIHBhZGRpbmc6ICIxMHB4IDE0cHgiLAogICAgICAgIGZvbnRTaXplOiAxNCwKICAgICAgICBmb250V2VpZ2h0OiA4MDAsCiAgICAgICAgY3Vyc29yOiBkaXNhYmxlZCA/ICJub3QtYWxsb3dlZCIgOiAicG9pbnRlciIsCiAgICAgICAgb3BhY2l0eTogZGlzYWJsZWQgPyAwLjU1IDogMSwKICAgICAgICAuLi5zdHlsZSwKICAgICAgfX0KICAgID4KICAgICAge2NoaWxkcmVufQogICAgPC9idXR0b24+CiAgKTsKfQoKZnVuY3Rpb24gSW5wdXQoewogIHZhbHVlLAogIG9uQ2hhbmdlLAogIHBsYWNlaG9sZGVyLAogIHR5cGUgPSAidGV4dCIsCiAgbGlzdCwKfTogewogIHZhbHVlOiBzdHJpbmc7CiAgb25DaGFuZ2U6ICh2OiBzdHJpbmcpID0+IHZvaWQ7CiAgcGxhY2Vob2xkZXI/OiBzdHJpbmc7CiAgdHlwZT86IHN0cmluZzsKICBsaXN0Pzogc3RyaW5nOwp9KSB7CiAgcmV0dXJuICgKICAgIDxpbnB1dAogICAgICB0eXBlPXt0eXBlfQogICAgICB2YWx1ZT17dmFsdWV9CiAgICAgIHBsYWNlaG9sZGVyPXtwbGFjZWhvbGRlcn0KICAgICAgbGlzdD17bGlzdH0KICAgICAgb25DaGFuZ2U9eyhlKSA9PiBvbkNoYW5nZShlLnRhcmdldC52YWx1ZSl9CiAgICAgIHN0eWxlPXt7CiAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICBib3JkZXJSYWRpdXM6IDEyLAogICAgICAgIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwKICAgICAgICBwYWRkaW5nOiAiMTBweCAxMnB4IiwKICAgICAgICBmb250U2l6ZTogMTQsCiAgICAgICAgb3V0bGluZTogIm5vbmUiLAogICAgICB9fQogICAgLz4KICApOwp9CgpmdW5jdGlvbiBQaWxsKHsgY2hpbGRyZW4gfTogeyBjaGlsZHJlbjogUmVhY3QuUmVhY3ROb2RlIH0pIHsKICByZXR1cm4gKAogICAgPHNwYW4KICAgICAgc3R5bGU9e3sKICAgICAgICBkaXNwbGF5OiAiaW5saW5lLWZsZXgiLAogICAgICAgIGFsaWduSXRlbXM6ICJjZW50ZXIiLAogICAgICAgIGJvcmRlclJhZGl1czogOTk5LAogICAgICAgIHBhZGRpbmc6ICI0cHggMTBweCIsCiAgICAgICAgZm9udFNpemU6IDEyLAogICAgICAgIGZvbnRXZWlnaHQ6IDgwMCwKICAgICAgICBiYWNrZ3JvdW5kOiAiI2Y0ZjRmNSIsCiAgICAgICAgY29sb3I6ICIjMTgxODFiIiwKICAgICAgICBib3JkZXI6ICIxcHggc29saWQgI2U0ZTRlNyIsCiAgICAgIH19CiAgICA+CiAgICAgIHtjaGlsZHJlbn0KICAgIDwvc3Bhbj4KICApOwp9CgpmdW5jdGlvbiBTaWRlYmFySXRlbSh7CiAgbGFiZWwsCiAgYWN0aXZlLAogIG9uQ2xpY2ssCn06IHsKICBsYWJlbDogc3RyaW5nOwogIGFjdGl2ZT86IGJvb2xlYW47CiAgb25DbGljaz86ICgpID0+IHZvaWQ7Cn0pIHsKICByZXR1cm4gKAogICAgPGRpdgogICAgICBvbkNsaWNrPXtvbkNsaWNrfQogICAgICBzdHlsZT17ewogICAgICAgIGJvcmRlclJhZGl1czogMTQsCiAgICAgICAgcGFkZGluZzogIjEwcHggMTJweCIsCiAgICAgICAgbWFyZ2luQm90dG9tOiA2LAogICAgICAgIGN1cnNvcjogInBvaW50ZXIiLAogICAgICAgIGJhY2tncm91bmQ6IGFjdGl2ZSA/ICIjMTgxODFiIiA6ICJ0cmFuc3BhcmVudCIsCiAgICAgICAgY29sb3I6IGFjdGl2ZSA/ICIjZmZmIiA6ICIjM2YzZjQ2IiwKICAgICAgICBmb250U2l6ZTogMTQsCiAgICAgICAgZm9udFdlaWdodDogYWN0aXZlID8gODAwIDogNjAwLAogICAgICB9fQogICAgPgogICAgICB7bGFiZWx9CiAgICA8L2Rpdj4KICApOwp9Cgpjb25zdCBsYWJlbFN0eWxlOiBSZWFjdC5DU1NQcm9wZXJ0aWVzID0geyBmb250U2l6ZTogMTMsIGNvbG9yOiAiIzNmM2Y0NiIsIGZvbnRXZWlnaHQ6IDcwMCwgbWFyZ2luQm90dG9tOiA2IH07CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09CiAgIERlZmF1bHRzIEVkaXRvciAoRXN0aW1hdGUtbGV2ZWwgKyBQb3NpdGlvbiAiVXNlIGVzdGltYXRlIGRlZmF1bHRzIikKPT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKZnVuY3Rpb24gRGVmYXVsdHNFZGl0b3IoewogIHRpdGxlLAogIHByb2R1Y3RUeXBlLAogIHZhbHVlLAogIG9uQ2hhbmdlLAogIHNob3dEb29yT3B0aW9ucywKfTogewogIHRpdGxlOiBzdHJpbmc7CiAgcHJvZHVjdFR5cGU6IFByb2R1Y3RUeXBlOwogIHZhbHVlOiBFc3RpbWF0ZURlZmF1bHRzOwogIG9uQ2hhbmdlOiAobmV4dDogRXN0aW1hdGVEZWZhdWx0cykgPT4gdm9pZDsKICBzaG93RG9vck9wdGlvbnM6IGJvb2xlYW47Cn0pIHsKICBjb25zdCBmaW5pc2hlcyA9IEZJTklTSEVTX0JZX1RZUEVbcHJvZHVjdFR5cGVdOwoKICAvLyBrZWVwIEcgZml4ZWQgYXQgMC41MyBmb3Igbm93IChwZXIgeW91ciBpbnN0cnVjdGlvbikKICB1c2VFZmZlY3QoKCkgPT4gewogICAgaWYgKHZhbHVlLmdWYWx1ZSAhPT0gIjAuNTMiKSBvbkNoYW5nZSh7IC4uLnZhbHVlLCBnVmFsdWU6ICIwLjUzIiB9KTsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHMKICB9LCBbdmFsdWUudWdWYWx1ZSwgdmFsdWUuZ2xhc3NUeXBlXSk7CgogIGNvbnN0IHVnT3B0aW9ucyA9IHZhbHVlLmdsYXNzVHlwZSA9PT0gIkRvdWJsZSIgPyBVR19ET1VCTEUgOiBVR19UUklQTEU7CgogIHJldHVybiAoCiAgICA8ZGl2IHN0eWxlPXt7IGJvcmRlclJhZGl1czogMTQsIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwgcGFkZGluZzogMTIgfX0+CiAgICAgIDxIMz57dGl0bGV9PC9IMz4KCiAgICAgIDxkaXYgc3R5bGU9e3sgbWFyZ2luVG9wOiAxMiwgZGlzcGxheTogImdyaWQiLCBnYXA6IDE0IH19PgogICAgICAgIHsvKiBTdXBwbGllciAmIFByb2R1Y3QgKi99CiAgICAgICAgPGRpdiBzdHlsZT17eyBib3JkZXJSYWRpdXM6IDE0LCBib3JkZXI6ICIxcHggc29saWQgI2U0ZTRlNyIsIHBhZGRpbmc6IDEyIH19PgogICAgICAgICAgPEgzPlN1cHBsaWVyICYgUHJvZHVjdDwvSDM+CgogICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDEwLCBkaXNwbGF5OiAiZ3JpZCIsIGdhcDogMTIgfX0+CiAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17bGFiZWxTdHlsZX0+U3VwcGxpZXI8L2Rpdj4KICAgICAgICAgICAgICA8c2VsZWN0CiAgICAgICAgICAgICAgICB2YWx1ZT17dmFsdWUuc3VwcGxpZXJ9CiAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHsKICAgICAgICAgICAgICAgICAgY29uc3Qgc3VwcGxpZXIgPSBlLnRhcmdldC52YWx1ZTsKICAgICAgICAgICAgICAgICAgY29uc3QgbmV4dFByb2QgPSBzdXBwbGllciA/IGZpcnN0UHJvZHVjdEZvclN1cHBsaWVyKHN1cHBsaWVyKSA6ICIiOwogICAgICAgICAgICAgICAgICBvbkNoYW5nZSh7IC4uLnZhbHVlLCBzdXBwbGllciwgcHJvZHVjdDogbmV4dFByb2QgfSk7CiAgICAgICAgICAgICAgICB9fQogICAgICAgICAgICAgICAgc3R5bGU9e3sgd2lkdGg6ICIxMDAlIiwgYm9yZGVyUmFkaXVzOiAxMiwgYm9yZGVyOiAiMXB4IHNvbGlkICNlNGU0ZTciLCBwYWRkaW5nOiAiMTBweCAxMnB4IiwgZm9udFNpemU6IDE0IH19CiAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iIj5TZWxlY3Qgc3VwcGxpZXLigKY8L29wdGlvbj4KICAgICAgICAgICAgICAgIHtTVVBQTElFUlMubWFwKChzKSA9PiAoCiAgICAgICAgICAgICAgICAgIDxvcHRpb24ga2V5PXtzLm5hbWV9IHZhbHVlPXtzLm5hbWV9PgogICAgICAgICAgICAgICAgICAgIHtzLm5hbWV9CiAgICAgICAgICAgICAgICAgIDwvb3B0aW9uPgogICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXtsYWJlbFN0eWxlfT5Qcm9kdWN0IHR5cGU8L2Rpdj4KICAgICAgICAgICAgICA8c2VsZWN0CiAgICAgICAgICAgICAgICB2YWx1ZT17dmFsdWUucHJvZHVjdFR5cGV9CiAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IG9uQ2hhbmdlKHsgLi4udmFsdWUsIHByb2R1Y3RUeXBlOiBlLnRhcmdldC52YWx1ZSBhcyBQcm9kdWN0VHlwZSB9KX0KICAgICAgICAgICAgICAgIHN0eWxlPXt7IHdpZHRoOiAiMTAwJSIsIGJvcmRlclJhZGl1czogMTIsIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwgcGFkZGluZzogIjEwcHggMTJweCIsIGZvbnRTaXplOiAxNCB9fQogICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgIHtQUk9EVUNUX1RZUEVTLm1hcCgodCkgPT4gKAogICAgICAgICAgICAgICAgICA8b3B0aW9uIGtleT17dH0gdmFsdWU9e3R9PgogICAgICAgICAgICAgICAgICAgIHt0fQogICAgICAgICAgICAgICAgICA8L29wdGlvbj4KICAgICAgICAgICAgICAgICkpfQogICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17bGFiZWxTdHlsZX0+UHJvZHVjdDwvZGl2PgogICAgICAgICAgICAgIDxzZWxlY3QKICAgICAgICAgICAgICAgIHZhbHVlPXt2YWx1ZS5wcm9kdWN0fQogICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBvbkNoYW5nZSh7IC4uLnZhbHVlLCBwcm9kdWN0OiBlLnRhcmdldC52YWx1ZSB9KX0KICAgICAgICAgICAgICAgIGRpc2FibGVkPXshdmFsdWUuc3VwcGxpZXJ9CiAgICAgICAgICAgICAgICBzdHlsZT17ewogICAgICAgICAgICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6IDEyLAogICAgICAgICAgICAgICAgICBib3JkZXI6ICIxcHggc29saWQgI2U0ZTRlNyIsCiAgICAgICAgICAgICAgICAgIHBhZGRpbmc6ICIxMHB4IDEycHgiLAogICAgICAgICAgICAgICAgICBmb250U2l6ZTogMTQsCiAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICF2YWx1ZS5zdXBwbGllciA/ICIjZmFmYWZhIiA6ICIjZmZmIiwKICAgICAgICAgICAgICAgICAgY29sb3I6ICF2YWx1ZS5zdXBwbGllciA/ICIjYTFhMWFhIiA6ICIjMTgxODFiIiwKICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iIj57dmFsdWUuc3VwcGxpZXIgPyAiU2VsZWN0IHByb2R1Y3TigKYiIDogIlNlbGVjdCBzdXBwbGllciBmaXJzdOKApiJ9PC9vcHRpb24+CiAgICAgICAgICAgICAgICB7YWxsUHJvZHVjdHNGb3JTdXBwbGllcih2YWx1ZS5zdXBwbGllcikubWFwKChwKSA9PiAoCiAgICAgICAgICAgICAgICAgIDxvcHRpb24ga2V5PXtwfSB2YWx1ZT17cH0+CiAgICAgICAgICAgICAgICAgICAge3B9CiAgICAgICAgICAgICAgICAgIDwvb3B0aW9uPgogICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CgogICAgICAgIHsvKiBGaW5pc2hlcyAqL30KICAgICAgICA8ZGl2IHN0eWxlPXt7IGJvcmRlclJhZGl1czogMTQsIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwgcGFkZGluZzogMTIgfX0+CiAgICAgICAgICA8SDM+RmluaXNoZXM8L0gzPgoKICAgICAgICAgIDxkYXRhbGlzdCBpZD17ImV4dC1maW5pc2gtIiArIHRpdGxlfT4KICAgICAgICAgICAge2ZpbmlzaGVzLmV4dGVybmFsLm1hcCgoeCkgPT4gKAogICAgICAgICAgICAgIDxvcHRpb24ga2V5PXt4fSB2YWx1ZT17eH0gLz4KICAgICAgICAgICAgKSl9CiAgICAgICAgICA8L2RhdGFsaXN0PgogICAgICAgICAgPGRhdGFsaXN0IGlkPXsiaW50LWZpbmlzaC0iICsgdGl0bGV9PgogICAgICAgICAgICB7ZmluaXNoZXMuaW50ZXJuYWwubWFwKCh4KSA9PiAoCiAgICAgICAgICAgICAgPG9wdGlvbiBrZXk9e3h9IHZhbHVlPXt4fSAvPgogICAgICAgICAgICApKX0KICAgICAgICAgIDwvZGF0YWxpc3Q+CgogICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDEwLCBkaXNwbGF5OiAiZ3JpZCIsIGdyaWRUZW1wbGF0ZUNvbHVtbnM6ICIxZnIgMWZyIiwgZ2FwOiAxMiB9fT4KICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXtsYWJlbFN0eWxlfT5FeHRlcm5hbCBmaW5pc2g8L2Rpdj4KICAgICAgICAgICAgICA8SW5wdXQKICAgICAgICAgICAgICAgIHZhbHVlPXt2YWx1ZS5leHRlcm5hbEZpbmlzaH0KICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsodikgPT4gb25DaGFuZ2UoeyAuLi52YWx1ZSwgZXh0ZXJuYWxGaW5pc2g6IHYgfSl9CiAgICAgICAgICAgICAgICBsaXN0PXsiZXh0LWZpbmlzaC0iICsgdGl0bGV9CiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj0iU2VsZWN0IG9yIHR5cGXigKYiCiAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17bGFiZWxTdHlsZX0+SW50ZXJuYWwgZmluaXNoPC9kaXY+CiAgICAgICAgICAgICAgPElucHV0CiAgICAgICAgICAgICAgICB2YWx1ZT17dmFsdWUuaW50ZXJuYWxGaW5pc2h9CiAgICAgICAgICAgICAgICBvbkNoYW5nZT17KHYpID0+IG9uQ2hhbmdlKHsgLi4udmFsdWUsIGludGVybmFsRmluaXNoOiB2IH0pfQogICAgICAgICAgICAgICAgbGlzdD17ImludC1maW5pc2gtIiArIHRpdGxlfQogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9IlNlbGVjdCBvciB0eXBl4oCmIgogICAgICAgICAgICAgIC8+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CgogICAgICAgIHsvKiBIaW5nZXMgKyBXb29kICovfQogICAgICAgIDxkaXYgc3R5bGU9e3sgYm9yZGVyUmFkaXVzOiAxNCwgYm9yZGVyOiAiMXB4IHNvbGlkICNlNGU0ZTciLCBwYWRkaW5nOiAxMiB9fT4KICAgICAgICAgIDxIMz5IYXJkd2FyZTwvSDM+CgogICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDEwLCBkaXNwbGF5OiAiZ3JpZCIsIGdyaWRUZW1wbGF0ZUNvbHVtbnM6ICIxZnIgMWZyIiwgZ2FwOiAxMiB9fT4KICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXtsYWJlbFN0eWxlfT5IaW5nZXM8L2Rpdj4KICAgICAgICAgICAgICA8c2VsZWN0CiAgICAgICAgICAgICAgICB2YWx1ZT17dmFsdWUuaGluZ2VUeXBlfQogICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBvbkNoYW5nZSh7IC4uLnZhbHVlLCBoaW5nZVR5cGU6IGUudGFyZ2V0LnZhbHVlIGFzIGFueSB9KX0KICAgICAgICAgICAgICAgIHN0eWxlPXt7IHdpZHRoOiAiMTAwJSIsIGJvcmRlclJhZGl1czogMTIsIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwgcGFkZGluZzogIjEwcHggMTJweCIsIGZvbnRTaXplOiAxNCB9fQogICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgIHtISU5HRV9UWVBFUy5tYXAoKHQpID0+ICgKICAgICAgICAgICAgICAgICAgPG9wdGlvbiBrZXk9e3R9IHZhbHVlPXt0fT4KICAgICAgICAgICAgICAgICAgICB7dH0KICAgICAgICAgICAgICAgICAgPC9vcHRpb24+CiAgICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICB7aXNUaW1iZXJQcm9kdWN0VHlwZSh2YWx1ZS5wcm9kdWN0VHlwZSkgPyAoCiAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e2xhYmVsU3R5bGV9Pldvb2QgdHlwZTwvZGl2PgogICAgICAgICAgICAgICAgPHNlbGVjdAogICAgICAgICAgICAgICAgICB2YWx1ZT17dmFsdWUud29vZFR5cGV9CiAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gb25DaGFuZ2UoeyAuLi52YWx1ZSwgd29vZFR5cGU6IGUudGFyZ2V0LnZhbHVlIH0pfQogICAgICAgICAgICAgICAgICBzdHlsZT17eyB3aWR0aDogIjEwMCUiLCBib3JkZXJSYWRpdXM6IDEyLCBib3JkZXI6ICIxcHggc29saWQgI2U0ZTRlNyIsIHBhZGRpbmc6ICIxMHB4IDEycHgiLCBmb250U2l6ZTogMTQgfX0KICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAge1dPT0RfVFlQRVMubWFwKCh3KSA9PiAoCiAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiBrZXk9e3d9IHZhbHVlPXt3fT4KICAgICAgICAgICAgICAgICAgICAgIHt3fQogICAgICAgICAgICAgICAgICAgIDwvb3B0aW9uPgogICAgICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICApIDogKAogICAgICAgICAgICAgIDxkaXYgLz4KICAgICAgICAgICAgKX0KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgICAgICB7LyogR2xhemluZyAqL30KICAgICAgICA8ZGl2IHN0eWxlPXt7IGJvcmRlclJhZGl1czogMTQsIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwgcGFkZGluZzogMTIgfX0+CiAgICAgICAgICA8SDM+R2xhemluZzwvSDM+CgogICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDEwLCBkaXNwbGF5OiAiZ3JpZCIsIGdyaWRUZW1wbGF0ZUNvbHVtbnM6ICIxZnIgMWZyIDFmciIsIGdhcDogMTIgfX0+CiAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17bGFiZWxTdHlsZX0+R2xhc3M8L2Rpdj4KICAgICAgICAgICAgICA8c2VsZWN0CiAgICAgICAgICAgICAgICB2YWx1ZT17dmFsdWUuZ2xhc3NUeXBlfQogICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGdsYXNzVHlwZSA9IGUudGFyZ2V0LnZhbHVlIGFzICJEb3VibGUiIHwgIlRyaXBsZSI7CiAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHRVZyA9IGdsYXNzVHlwZSA9PT0gIkRvdWJsZSIgPyAiMS4xIiA6ICIwLjQiOwogICAgICAgICAgICAgICAgICBvbkNoYW5nZSh7IC4uLnZhbHVlLCBnbGFzc1R5cGUsIHVnVmFsdWU6IG5leHRVZywgZ1ZhbHVlOiAiMC41MyIgfSk7CiAgICAgICAgICAgICAgICB9fQogICAgICAgICAgICAgICAgc3R5bGU9e3sgd2lkdGg6ICIxMDAlIiwgYm9yZGVyUmFkaXVzOiAxMiwgYm9yZGVyOiAiMXB4IHNvbGlkICNlNGU0ZTciLCBwYWRkaW5nOiAiMTBweCAxMnB4IiwgZm9udFNpemU6IDE0IH19CiAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iRG91YmxlIj5Eb3VibGU8L29wdGlvbj4KICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlRyaXBsZSI+VHJpcGxlPC9vcHRpb24+CiAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXtsYWJlbFN0eWxlfT5VZyB2YWx1ZSByZXF1aXJlZDwvZGl2PgogICAgICAgICAgICAgIDxzZWxlY3QKICAgICAgICAgICAgICAgIHZhbHVlPXt2YWx1ZS51Z1ZhbHVlfQogICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBvbkNoYW5nZSh7IC4uLnZhbHVlLCB1Z1ZhbHVlOiBlLnRhcmdldC52YWx1ZSwgZ1ZhbHVlOiAiMC41MyIgfSl9CiAgICAgICAgICAgICAgICBzdHlsZT17eyB3aWR0aDogIjEwMCUiLCBib3JkZXJSYWRpdXM6IDEyLCBib3JkZXI6ICIxcHggc29saWQgI2U0ZTRlNyIsIHBhZGRpbmc6ICIxMHB4IDEycHgiLCBmb250U2l6ZTogMTQgfX0KICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICB7dWdPcHRpb25zLm1hcCgodSkgPT4gKAogICAgICAgICAgICAgICAgICA8b3B0aW9uIGtleT17dX0gdmFsdWU9e3V9PgogICAgICAgICAgICAgICAgICAgIHt1fQogICAgICAgICAgICAgICAgICA8L29wdGlvbj4KICAgICAgICAgICAgICAgICkpfQogICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17bGFiZWxTdHlsZX0+RyB2YWx1ZTwvZGl2PgogICAgICAgICAgICAgIDxJbnB1dCB2YWx1ZT17dmFsdWUuZ1ZhbHVlfSBvbkNoYW5nZT17KHYpID0+IG9uQ2hhbmdlKHsgLi4udmFsdWUsIGdWYWx1ZTogdiB9KX0gLz4KICAgICAgICAgICAgICA8U21hbGw+UGxhY2Vob2xkZXI6IGZpeGVkIGF0IDAuNTMgZm9yIG5vdzwvU21hbGw+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CgogICAgICAgIHsvKiBXaW5kb3cgSGFuZGxlICovfQogICAgICAgIDxkaXYgc3R5bGU9e3sgYm9yZGVyUmFkaXVzOiAxNCwgYm9yZGVyOiAiMXB4IHNvbGlkICNlNGU0ZTciLCBwYWRkaW5nOiAxMiB9fT4KICAgICAgICAgIDxIMz5XaW5kb3cgSGFuZGxlPC9IMz4KCiAgICAgICAgICA8ZGl2IHN0eWxlPXt7IG1hcmdpblRvcDogMTAsIGRpc3BsYXk6ICJncmlkIiwgZ3JpZFRlbXBsYXRlQ29sdW1uczogIjFmciAxNjBweCIsIGdhcDogMTIsIGFsaWduSXRlbXM6ICJjZW50ZXIiIH19PgogICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e2xhYmVsU3R5bGV9PkhhbmRsZSB0eXBlPC9kaXY+CiAgICAgICAgICAgICAgPHNlbGVjdAogICAgICAgICAgICAgICAgdmFsdWU9e3ZhbHVlLndpbmRvd0hhbmRsZVR5cGV9CiAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IG9uQ2hhbmdlKHsgLi4udmFsdWUsIHdpbmRvd0hhbmRsZVR5cGU6IGUudGFyZ2V0LnZhbHVlIGFzIGFueSB9KX0KICAgICAgICAgICAgICAgIHN0eWxlPXt7IHdpZHRoOiAiMTAwJSIsIGJvcmRlclJhZGl1czogMTIsIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwgcGFkZGluZzogIjEwcHggMTJweCIsIGZvbnRTaXplOiAxNCB9fQogICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgIHtIQU5ETEVfVFlQRVMubWFwKCh0KSA9PiAoCiAgICAgICAgICAgICAgICAgIDxvcHRpb24ga2V5PXt0fSB2YWx1ZT17dH0+CiAgICAgICAgICAgICAgICAgICAge3R9CiAgICAgICAgICAgICAgICAgIDwvb3B0aW9uPgogICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdgogICAgICAgICAgICAgIHN0eWxlPXt7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDk2LAogICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAxMiwKICAgICAgICAgICAgICAgIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwKICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICIjZmFmYWZhIiwKICAgICAgICAgICAgICAgIGRpc3BsYXk6ICJmbGV4IiwKICAgICAgICAgICAgICAgIGFsaWduSXRlbXM6ICJjZW50ZXIiLAogICAgICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6ICJjZW50ZXIiLAogICAgICAgICAgICAgICAgY29sb3I6ICIjNzE3MTdhIiwKICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6IDgwMCwKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAxMiwKICAgICAgICAgICAgICB9fQogICAgICAgICAgICA+CiAgICAgICAgICAgICAgSGFuZGxlIGltYWdlCiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CgogICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDEwIH19PgogICAgICAgICAgICA8bGFiZWwgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBnYXA6IDgsIGFsaWduSXRlbXM6ICJjZW50ZXIiLCBmb250U2l6ZTogMTQsIGZvbnRXZWlnaHQ6IDcwMCB9fT4KICAgICAgICAgICAgICA8aW5wdXQKICAgICAgICAgICAgICAgIHR5cGU9ImNoZWNrYm94IgogICAgICAgICAgICAgICAgY2hlY2tlZD17dmFsdWUuaW50ZXJuYWxDaWxsUmVxdWlyZWR9CiAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IG9uQ2hhbmdlKHsgLi4udmFsdWUsIGludGVybmFsQ2lsbFJlcXVpcmVkOiBlLnRhcmdldC5jaGVja2VkIH0pfQogICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgTG9ja2FibGUgaGFuZGxlCiAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgIDxTbWFsbD5UaGlzIHdhcyBwcmV2aW91c2x5IOKAnGRvb3IgbXVsdGlwb2ludCBsb2NraW5n4oCdIOKAlCBub3cgYWxpZ25lZCB0byB5b3VyIOKAnGxvY2thYmxlIGhhbmRsZeKAnSB3b3JkaW5nLjwvU21hbGw+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgey8qIERvb3Igb3B0aW9ucyAqL30KICAgICAgICB7c2hvd0Rvb3JPcHRpb25zICYmICgKICAgICAgICAgIDxkaXYgc3R5bGU9e3sgYm9yZGVyUmFkaXVzOiAxNCwgYm9yZGVyOiAiMXB4IHNvbGlkICNlNGU0ZTciLCBwYWRkaW5nOiAxMiB9fT4KICAgICAgICAgICAgPEgzPkRvb3Igb3B0aW9uczwvSDM+CgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IG1hcmdpblRvcDogMTAsIGRpc3BsYXk6ICJncmlkIiwgZ2FwOiAxMCB9fT4KICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBnYXA6IDgsIGFsaWduSXRlbXM6ICJjZW50ZXIiLCBmb250U2l6ZTogMTQsIGZvbnRXZWlnaHQ6IDcwMCB9fT4KICAgICAgICAgICAgICAgIDxpbnB1dAogICAgICAgICAgICAgICAgICB0eXBlPSJjaGVja2JveCIKICAgICAgICAgICAgICAgICAgY2hlY2tlZD17dmFsdWUuZG9vck11bHRpcG9pbnRMb2NraW5nfQogICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IG9uQ2hhbmdlKHsgLi4udmFsdWUsIGRvb3JNdWx0aXBvaW50TG9ja2luZzogZS50YXJnZXQuY2hlY2tlZCB9KX0KICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICBNdWx0aXBvaW50IGxvY2tpbmcKICAgICAgICAgICAgICA8L2xhYmVsPgoKICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBnYXA6IDgsIGFsaWduSXRlbXM6ICJjZW50ZXIiLCBmb250U2l6ZTogMTQsIGZvbnRXZWlnaHQ6IDcwMCB9fT4KICAgICAgICAgICAgICAgIDxpbnB1dAogICAgICAgICAgICAgICAgICB0eXBlPSJjaGVja2JveCIKICAgICAgICAgICAgICAgICAgY2hlY2tlZD17dmFsdWUuZWxlY3RyaWNhbE9wZXJhdGlvbn0KICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBvbkNoYW5nZSh7IC4uLnZhbHVlLCBlbGVjdHJpY2FsT3BlcmF0aW9uOiBlLnRhcmdldC5jaGVja2VkIH0pfQogICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgIEVsZWN0cmljYWwgb3BlcmF0aW9uCiAgICAgICAgICAgICAgPC9sYWJlbD4KCiAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPXt7IGRpc3BsYXk6ICJmbGV4IiwgZ2FwOiA4LCBhbGlnbkl0ZW1zOiAiY2VudGVyIiwgZm9udFNpemU6IDE0LCBmb250V2VpZ2h0OiA3MDAgfX0+CiAgICAgICAgICAgICAgICA8aW5wdXQKICAgICAgICAgICAgICAgICAgdHlwZT0iY2hlY2tib3giCiAgICAgICAgICAgICAgICAgIGNoZWNrZWQ9e3ZhbHVlLmRheUxhdGNofQogICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IG9uQ2hhbmdlKHsgLi4udmFsdWUsIGRheUxhdGNoOiBlLnRhcmdldC5jaGVja2VkIH0pfQogICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgIERheSBsYXRjaAogICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgKX0KCiAgICAgICAgey8qIEFjY2Vzc29yaWVzICovfQogICAgICAgIDxkaXYgc3R5bGU9e3sgYm9yZGVyUmFkaXVzOiAxNCwgYm9yZGVyOiAiMXB4IHNvbGlkICNlNGU0ZTciLCBwYWRkaW5nOiAxMiB9fT4KICAgICAgICAgIDxIMz5BY2Nlc3NvcmllczwvSDM+CgogICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDEwLCBkaXNwbGF5OiAiZ3JpZCIsIGdhcDogMTIgfX0+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImdyaWQiLCBncmlkVGVtcGxhdGVDb2x1bW5zOiAiMWZyIDFmciIsIGdhcDogMTIgfX0+CiAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPXt7IGRpc3BsYXk6ICJmbGV4IiwgZ2FwOiA4LCBhbGlnbkl0ZW1zOiAiY2VudGVyIiwgZm9udFNpemU6IDE0LCBmb250V2VpZ2h0OiA3MDAgfX0+CiAgICAgICAgICAgICAgICA8aW5wdXQKICAgICAgICAgICAgICAgICAgdHlwZT0iY2hlY2tib3giCiAgICAgICAgICAgICAgICAgIGNoZWNrZWQ9e3ZhbHVlLmludGVybmFsQ2lsbFJlcXVpcmVkfQogICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IG9uQ2hhbmdlKHsgLi4udmFsdWUsIGludGVybmFsQ2lsbFJlcXVpcmVkOiBlLnRhcmdldC5jaGVja2VkIH0pfQogICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgIFdpbmRvdyBjaWxsIGludGVybmFsbHkgcmVxdWlyZWQKICAgICAgICAgICAgICA8L2xhYmVsPgoKICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBnYXA6IDgsIGFsaWduSXRlbXM6ICJjZW50ZXIiLCBmb250U2l6ZTogMTQsIGZvbnRXZWlnaHQ6IDcwMCB9fT4KICAgICAgICAgICAgICAgIDxpbnB1dAogICAgICAgICAgICAgICAgICB0eXBlPSJjaGVja2JveCIKICAgICAgICAgICAgICAgICAgY2hlY2tlZD17dmFsdWUuZXh0ZXJuYWxTaWxsUmVxdWlyZWR9CiAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gb25DaGFuZ2UoeyAuLi52YWx1ZSwgZXh0ZXJuYWxTaWxsUmVxdWlyZWQ6IGUudGFyZ2V0LmNoZWNrZWQgfSl9CiAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgV2luZG93IHNpbGwgZXh0ZXJuYWxseSByZXF1aXJlZAogICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZ3JpZCIsIGdyaWRUZW1wbGF0ZUNvbHVtbnM6ICIxZnIgMWZyIiwgZ2FwOiAxMiB9fT4KICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17bGFiZWxTdHlsZX0+V2luZG93IGNpbGwgZGVwdGg8L2Rpdj4KICAgICAgICAgICAgICAgIDxzZWxlY3QKICAgICAgICAgICAgICAgICAgdmFsdWU9e1N0cmluZyh2YWx1ZS5jaWxsRGVwdGhNbSl9CiAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gb25DaGFuZ2UoeyAuLi52YWx1ZSwgY2lsbERlcHRoTW06IE51bWJlcihlLnRhcmdldC52YWx1ZSkgfSl9CiAgICAgICAgICAgICAgICAgIHN0eWxlPXt7IHdpZHRoOiAiMTAwJSIsIGJvcmRlclJhZGl1czogMTIsIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwgcGFkZGluZzogIjEwcHggMTJweCIsIGZvbnRTaXplOiAxNCB9fQogICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICB7Q0lMTF9ERVBUSFMubWFwKChkKSA9PiAoCiAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiBrZXk9e2R9IHZhbHVlPXtkfT4KICAgICAgICAgICAgICAgICAgICAgIHtkfSBtbQogICAgICAgICAgICAgICAgICAgIDwvb3B0aW9uPgogICAgICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17bGFiZWxTdHlsZX0+Q2lsbCBlbmQgY2FwIHR5cGU8L2Rpdj4KICAgICAgICAgICAgICAgIDxzZWxlY3QKICAgICAgICAgICAgICAgICAgdmFsdWU9e3ZhbHVlLmNpbGxFbmRDYXBUeXBlfQogICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IG9uQ2hhbmdlKHsgLi4udmFsdWUsIGNpbGxFbmRDYXBUeXBlOiBlLnRhcmdldC52YWx1ZSBhcyBhbnkgfSl9CiAgICAgICAgICAgICAgICAgIHN0eWxlPXt7IHdpZHRoOiAiMTAwJSIsIGJvcmRlclJhZGl1czogMTIsIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwgcGFkZGluZzogIjEwcHggMTJweCIsIGZvbnRTaXplOiAxNCB9fQogICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJDbGFkZGluZy9SZW5kZXIgRW5kIENhcCI+Q2xhZGRpbmcvUmVuZGVyIEVuZCBDYXA8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iQnJpY2sgVHlwZSBFbmQgQ2FwIj5CcmljayBUeXBlIEVuZCBDYXA8L29wdGlvbj4KICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgPEgzPkZyYW1lIGV4dGVuc2lvbnM8L0gzPgogICAgICAgICAgICAgIDxTbWFsbD5TZXQgZWFjaCBzaWRlIGluZGVwZW5kZW50bHkuPC9TbWFsbD4KCiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDEwLCBkaXNwbGF5OiAiZ3JpZCIsIGdyaWRUZW1wbGF0ZUNvbHVtbnM6ICIxZnIgMWZyIDFmciAxZnIiLCBnYXA6IDEyIH19PgogICAgICAgICAgICAgICAge1sKICAgICAgICAgICAgICAgICAgWyJMZWZ0IiwgImZyYW1lRXh0TGVmdE1tIl0sCiAgICAgICAgICAgICAgICAgIFsiUmlnaHQiLCAiZnJhbWVFeHRSaWdodE1tIl0sCiAgICAgICAgICAgICAgICAgIFsiVG9wIiwgImZyYW1lRXh0VG9wTW0iXSwKICAgICAgICAgICAgICAgICAgWyJCb3R0b20iLCAiZnJhbWVFeHRCb3R0b21NbSJdLAogICAgICAgICAgICAgICAgXS5tYXAoKFtsYWJlbCwga2V5XSkgPT4gKAogICAgICAgICAgICAgICAgICA8ZGl2IGtleT17a2V5fT4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXtsYWJlbFN0eWxlfT57bGFiZWx9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPHNlbGVjdAogICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e1N0cmluZygodmFsdWUgYXMgYW55KVtrZXldKX0KICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gb25DaGFuZ2UoeyAuLi52YWx1ZSwgW2tleV06IE51bWJlcihlLnRhcmdldC52YWx1ZSkgfSBhcyBhbnkpfQogICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3sgd2lkdGg6ICIxMDAlIiwgYm9yZGVyUmFkaXVzOiAxMiwgYm9yZGVyOiAiMXB4IHNvbGlkICNlNGU0ZTciLCBwYWRkaW5nOiAiMTBweCAxMnB4IiwgZm9udFNpemU6IDE0IH19CiAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAge0ZSQU1FX0VYVFMubWFwKChtbSkgPT4gKAogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIGtleT17bW19IHZhbHVlPXttbX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAge21tfSBtbQogICAgICAgICAgICAgICAgICAgICAgICA8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICkpfQogICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICkpfQogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPXt7IGRpc3BsYXk6ICJmbGV4IiwgZ2FwOiA4LCBhbGlnbkl0ZW1zOiAiY2VudGVyIiwgZm9udFNpemU6IDE0LCBmb250V2VpZ2h0OiA3MDAgfX0+CiAgICAgICAgICAgICAgICA8aW5wdXQKICAgICAgICAgICAgICAgICAgdHlwZT0iY2hlY2tib3giCiAgICAgICAgICAgICAgICAgIGNoZWNrZWQ9e3ZhbHVlLnN1blByb3RlY3Rpb25SZXF1aXJlZH0KICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBvbkNoYW5nZSh7IC4uLnZhbHVlLCBzdW5Qcm90ZWN0aW9uUmVxdWlyZWQ6IGUudGFyZ2V0LmNoZWNrZWQgfSl9CiAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgU3VuIHByb3RlY3Rpb24gcmVxdWlyZWQKICAgICAgICAgICAgICA8L2xhYmVsPgoKICAgICAgICAgICAgICB7dmFsdWUuc3VuUHJvdGVjdGlvblJlcXVpcmVkICYmICgKICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgbWFyZ2luVG9wOiAxMCB9fT4KICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17bGFiZWxTdHlsZX0+VHlwZTwvZGl2PgogICAgICAgICAgICAgICAgICA8c2VsZWN0CiAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3ZhbHVlLnN1blByb3RlY3Rpb25UeXBlfQogICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gb25DaGFuZ2UoeyAuLi52YWx1ZSwgc3VuUHJvdGVjdGlvblR5cGU6IGUudGFyZ2V0LnZhbHVlIGFzIGFueSB9KX0KICAgICAgICAgICAgICAgICAgICBzdHlsZT17eyB3aWR0aDogIjEwMCUiLCBib3JkZXJSYWRpdXM6IDEyLCBib3JkZXI6ICIxcHggc29saWQgI2U0ZTRlNyIsIHBhZGRpbmc6ICIxMHB4IDEycHgiLCBmb250U2l6ZTogMTQgfX0KICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgIHtTVU5fUFJPVEVDVElPTi5tYXAoKHQpID0+ICgKICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24ga2V5PXt0fSB2YWx1ZT17dH0+CiAgICAgICAgICAgICAgICAgICAgICAgIHt0fQogICAgICAgICAgICAgICAgICAgICAgPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICApOwp9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09CiAgIE1haW4gQXBwCj09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIEFwcCgpIHsKICBjb25zdCBbbWVudSwgc2V0TWVudV0gPSB1c2VTdGF0ZTxNZW51S2V5PigiY3VzdG9tZXJzX2J1c2luZXNzIik7CiAgY29uc3QgW3ZpZXcsIHNldFZpZXddID0gdXNlU3RhdGU8Vmlldz4oImN1c3RvbWVycyIpOwoKICBjb25zdCBbY2xpZW50Q291bnRlciwgc2V0Q2xpZW50Q291bnRlcl0gPSB1c2VTdGF0ZSgzKTsKICBjb25zdCBbZXN0aW1hdGVDb3VudGVyLCBzZXRFc3RpbWF0ZUNvdW50ZXJdID0gdXNlU3RhdGUoMSk7CgogIGNvbnN0IFtjbGllbnRzLCBzZXRDbGllbnRzXSA9IHVzZVN0YXRlPENsaWVudFtdPigoKSA9PiBtYWtlRGVmYXVsdENsaWVudHMoKSk7CgogIGNvbnN0IFtzZWxlY3RlZENsaWVudElkLCBzZXRTZWxlY3RlZENsaWVudElkXSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGw+KG51bGwpOwogIGNvbnN0IHNlbGVjdGVkQ2xpZW50ID0gdXNlTWVtbygoKSA9PiBjbGllbnRzLmZpbmQoKGMpID0+IGMuaWQgPT09IHNlbGVjdGVkQ2xpZW50SWQpID8/IG51bGwsIFtjbGllbnRzLCBzZWxlY3RlZENsaWVudElkXSk7CgogIGNvbnN0IFtzZWxlY3RlZEVzdGltYXRlSWQsIHNldFNlbGVjdGVkRXN0aW1hdGVJZF0gPSB1c2VTdGF0ZTxzdHJpbmcgfCBudWxsPihudWxsKTsKICBjb25zdCBzZWxlY3RlZEVzdGltYXRlID0gdXNlTWVtbygoKSA9PiB7CiAgICBpZiAoIXNlbGVjdGVkQ2xpZW50KSByZXR1cm4gbnVsbDsKICAgIHJldHVybiBzZWxlY3RlZENsaWVudC5lc3RpbWF0ZXMuZmluZCgoZSkgPT4gZS5pZCA9PT0gc2VsZWN0ZWRFc3RpbWF0ZUlkKSA/PyBudWxsOwogIH0sIFtzZWxlY3RlZENsaWVudCwgc2VsZWN0ZWRFc3RpbWF0ZUlkXSk7CgogIC8vIGVzdGltYXRlIHBpY2tlcgogIGNvbnN0IFtwaWNrZXJDbGllbnRJZCwgc2V0UGlja2VyQ2xpZW50SWRdID0gdXNlU3RhdGU8c3RyaW5nIHwgbnVsbD4obnVsbCk7CiAgY29uc3QgcGlja2VyQ2xpZW50ID0gdXNlTWVtbygoKSA9PiBjbGllbnRzLmZpbmQoKGMpID0+IGMuaWQgPT09IHBpY2tlckNsaWVudElkKSA/PyBudWxsLCBbY2xpZW50cywgcGlja2VyQ2xpZW50SWRdKTsKCiAgLy8gQWRkIGNsaWVudCBVSSAoa2VwdCBzaW1wbGU7IHlvdXIgY3VycmVudCBhZGQgZm9ybSBjYW4gYmUgcmUtbWVyZ2VkIGlmIG5lZWRlZCkKICBjb25zdCBbc2hvd0FkZENsaWVudCwgc2V0U2hvd0FkZENsaWVudF0gPSB1c2VTdGF0ZShmYWxzZSk7CiAgY29uc3QgW2RyYWZ0Q2xpZW50TmFtZSwgc2V0RHJhZnRDbGllbnROYW1lXSA9IHVzZVN0YXRlKCIiKTsKICBjb25zdCBbZHJhZnRCdXNpbmVzc05hbWUsIHNldERyYWZ0QnVzaW5lc3NOYW1lXSA9IHVzZVN0YXRlKCIiKTsKICBjb25zdCBbZHJhZnRFbWFpbCwgc2V0RHJhZnRFbWFpbF0gPSB1c2VTdGF0ZSgiIik7CiAgY29uc3QgW2RyYWZ0TW9iaWxlLCBzZXREcmFmdE1vYmlsZV0gPSB1c2VTdGF0ZSgiIik7CiAgY29uc3QgW2RyYWZ0SG9tZSwgc2V0RHJhZnRIb21lXSA9IHVzZVN0YXRlKCIiKTsKCiAgLy8gUG9zaXRpb24gd2l6YXJkIChzdXBwbGllci9wcm9kdWN0IHJlbW92ZWQgZnJvbSBmbG93KQogIGNvbnN0IFtzaG93UG9zaXRpb25XaXphcmQsIHNldFNob3dQb3NpdGlvbldpemFyZF0gPSB1c2VTdGF0ZShmYWxzZSk7CiAgY29uc3QgW3Bvc1N0ZXAsIHNldFBvc1N0ZXBdID0gdXNlU3RhdGU8MSB8IDIgfCAzPigxKTsgLy8gMSBQb3NpdGlvbiwgMiBEaW1lbnNpb25zLCAzIENvbmZpZ3VyYXRpb24KICBjb25zdCBbcG9zRHJhZnQsIHNldFBvc0RyYWZ0XSA9IHVzZVN0YXRlPFBvc2l0aW9uPigoKSA9PiAoewogICAgaWQ6IHVpZCgpLAogICAgcG9zaXRpb25SZWY6ICJXLTAwMSIsCiAgICBxdHk6IDEsCiAgICByb29tTmFtZTogIiIsCiAgICB3aWR0aE1tOiAxMDAwLAogICAgaGVpZ2h0TW06IDEyMDAsCiAgICBmaWVsZHNYOiAxLAogICAgZmllbGRzWTogMSwKICAgIGluc2VydGlvbjogIkZpeGVkIiwKICAgIGNlbGxJbnNlcnRpb25zOiB7ICIwLDAiOiAiRml4ZWQiIH0sCiAgICBwb3NpdGlvblR5cGU6ICJXaW5kb3ciLAogICAgdXNlRXN0aW1hdGVEZWZhdWx0czogdHJ1ZSwKICAgIG92ZXJyaWRlczoge30sCiAgfSkpOwoKICAvLyBBZGQgUG9zaXRpb24gLyBDb25maWd1cmF0aW9uIHN0ZXAgaGVscGVycwogIGNvbnN0IFtkcmFmdFNlbGVjdGVkQ2VsbCwgc2V0RHJhZnRTZWxlY3RlZENlbGxdID0gdXNlU3RhdGU8eyBjb2w6IG51bWJlcjsgcm93OiBudW1iZXIgfT4oeyBjb2w6IDAsIHJvdzogMCB9KTsKICBjb25zdCBbcHJldmlld1ZpZXcsIHNldFByZXZpZXdWaWV3XSA9IHVzZVN0YXRlPCJJbnNpZGUiIHwgIk91dHNpZGUiPigiSW5zaWRlIik7CiAgY29uc3QgW29wZW5pbmdTdGQsIHNldE9wZW5pbmdTdGRdID0gdXNlU3RhdGU8IkRJTiIgfCAiVUsiPigiRElOIik7CgogIGNvbnN0IGFjdGl2ZUNsaWVudFR5cGU6IENsaWVudFR5cGUgPSBtZW51ID09PSAiY3VzdG9tZXJzX2J1c2luZXNzIiA/ICJCdXNpbmVzcyIgOiAiSW5kaXZpZHVhbCI7CiAgY29uc3QgZmlsdGVyZWRDbGllbnRzID0gdXNlTWVtbygoKSA9PiBjbGllbnRzLmZpbHRlcigoYykgPT4gYy50eXBlID09PSBhY3RpdmVDbGllbnRUeXBlKSwgW2NsaWVudHMsIGFjdGl2ZUNsaWVudFR5cGVdKTsKCiAgZnVuY3Rpb24gc2VsZWN0TWVudShrOiBNZW51S2V5KSB7CiAgICBzZXRNZW51KGspOwogICAgc2V0VmlldygiY3VzdG9tZXJzIik7CiAgICBzZXRTZWxlY3RlZENsaWVudElkKG51bGwpOwogICAgc2V0U2VsZWN0ZWRFc3RpbWF0ZUlkKG51bGwpOwogICAgc2V0UGlja2VyQ2xpZW50SWQobnVsbCk7CiAgICBzZXRTaG93QWRkQ2xpZW50KGZhbHNlKTsKICAgIHNldFNob3dQb3NpdGlvbldpemFyZChmYWxzZSk7CiAgfQoKICBmdW5jdGlvbiBvcGVuRXN0aW1hdGVXb3Jrc3BhY2UoY2xpZW50SWQ6IHN0cmluZywgZXN0aW1hdGVJZDogc3RyaW5nKSB7CiAgICBzZXRTZWxlY3RlZENsaWVudElkKGNsaWVudElkKTsKICAgIHNldFNlbGVjdGVkRXN0aW1hdGVJZChlc3RpbWF0ZUlkKTsKICAgIHNldFZpZXcoImVzdGltYXRlX3dvcmtzcGFjZSIpOwogICAgc2V0U2hvd1Bvc2l0aW9uV2l6YXJkKGZhbHNlKTsKICB9CgogIGZ1bmN0aW9uIG9wZW5Fc3RpbWF0ZURlZmF1bHRzKGNsaWVudElkOiBzdHJpbmcsIGVzdGltYXRlSWQ6IHN0cmluZykgewogICAgc2V0U2VsZWN0ZWRDbGllbnRJZChjbGllbnRJZCk7CiAgICBzZXRTZWxlY3RlZEVzdGltYXRlSWQoZXN0aW1hdGVJZCk7CiAgICBzZXRWaWV3KCJlc3RpbWF0ZV9kZWZhdWx0cyIpOwogICAgc2V0U2hvd1Bvc2l0aW9uV2l6YXJkKGZhbHNlKTsKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZUVzdGltYXRlRm9yQ2xpZW50KGNsaWVudDogQ2xpZW50KSB7CiAgICBjb25zdCB5ZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpOwogICAgY29uc3QgYmFzZSA9IG5leHRFc3RpbWF0ZUJhc2VSZWYoeWVhciwgZXN0aW1hdGVDb3VudGVyKTsKCiAgICBjb25zdCBlc3Q6IEVzdGltYXRlID0gewogICAgICBpZDogdWlkKCksCiAgICAgIGVzdGltYXRlUmVmOiBiYXNlLAogICAgICBiYXNlRXN0aW1hdGVSZWY6IGJhc2UsCiAgICAgIHJldmlzaW9uTm86IDAsCiAgICAgIHN0YXR1czogIkRyYWZ0IiwKICAgICAgZGVmYXVsdHM6IG1ha2VEZWZhdWx0RXN0aW1hdGVEZWZhdWx0cygpLAogICAgICBwb3NpdGlvbnM6IFtdLAogICAgfTsKCiAgICBzZXRFc3RpbWF0ZUNvdW50ZXIoKG4pID0+IG4gKyAxKTsKCiAgICBzZXRDbGllbnRzKChwcmV2KSA9PgogICAgICBwcmV2Lm1hcCgoYykgPT4gKGMuaWQgPT09IGNsaWVudC5pZCA/IHsgLi4uYywgZXN0aW1hdGVzOiBbZXN0LCAuLi5jLmVzdGltYXRlc10gfSA6IGMpKQogICAgKTsKCiAgICAvLyBJTVBPUlRBTlQ6IGdvIHRvIFN1cHBsaWVyICYgUHJvZHVjdCBEZWZhdWx0cyBzY3JlZW4gaW1tZWRpYXRlbHkKICAgIG9wZW5Fc3RpbWF0ZURlZmF1bHRzKGNsaWVudC5pZCwgZXN0LmlkKTsKICB9CgogIGZ1bmN0aW9uIG9wZW5DbGllbnQoY2xpZW50OiBDbGllbnQpIHsKICAgIHNldFNlbGVjdGVkQ2xpZW50SWQoY2xpZW50LmlkKTsKCiAgICBpZiAoY2xpZW50LmVzdGltYXRlcy5sZW5ndGggPT09IDApIHsKICAgICAgY3JlYXRlRXN0aW1hdGVGb3JDbGllbnQoY2xpZW50KTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmIChjbGllbnQuZXN0aW1hdGVzLmxlbmd0aCA9PT0gMSkgewogICAgICBvcGVuRXN0aW1hdGVEZWZhdWx0cyhjbGllbnQuaWQsIGNsaWVudC5lc3RpbWF0ZXNbMF0uaWQpOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gbXVsdGlwbGUgZXN0aW1hdGVzID0+IHNob3cgcGlja2VyIGxpc3QKICAgIHNldFBpY2tlckNsaWVudElkKGNsaWVudC5pZCk7CiAgICBzZXRWaWV3KCJlc3RpbWF0ZV9waWNrZXIiKTsKICB9CgogIGZ1bmN0aW9uIG9wZW5Fc3RpbWF0ZUZyb21QaWNrZXIoZXN0aW1hdGVJZDogc3RyaW5nKSB7CiAgICBpZiAoIXBpY2tlckNsaWVudElkKSByZXR1cm47CiAgICBvcGVuRXN0aW1hdGVEZWZhdWx0cyhwaWNrZXJDbGllbnRJZCwgZXN0aW1hdGVJZCk7CiAgfQoKICBmdW5jdGlvbiBzdGFydEFkZFBvc2l0aW9uKCkgewogICAgaWYgKCFzZWxlY3RlZEVzdGltYXRlKSByZXR1cm47CgogICAgY29uc3QgbmV4dEluZGV4ID0gKHNlbGVjdGVkRXN0aW1hdGUucG9zaXRpb25zPy5sZW5ndGggPz8gMCkgKyAxOwoKICAgIHNldFBvc1N0ZXAoMSk7CiAgICAgIHNldERyYWZ0U2VsZWN0ZWRDZWxsKHsgY29sOiAwLCByb3c6IDAgfSk7CiAgICBzZXRQb3NEcmFmdCh7CiAgICAgIGlkOiB1aWQoKSwKICAgICAgcG9zaXRpb25SZWY6IGBXLSR7cGFkMyhuZXh0SW5kZXgpfWAsCiAgICAgIHF0eTogMSwKICAgICAgcm9vbU5hbWU6ICIiLAogICAgICB3aWR0aE1tOiAxMDAwLAogICAgICBoZWlnaHRNbTogMTIwMCwKICAgICAgZmllbGRzWDogMSwKICAgICAgZmllbGRzWTogMSwKICAgICAgaW5zZXJ0aW9uOiAiRml4ZWQiLAogICAgICBwb3NpdGlvblR5cGU6ICJXaW5kb3ciLAogICAgICB1c2VFc3RpbWF0ZURlZmF1bHRzOiB0cnVlLAogICAgICBvdmVycmlkZXM6IHt9LAogICAgfSk7CiAgICBzZXRTaG93UG9zaXRpb25XaXphcmQodHJ1ZSk7CiAgfQoKICBmdW5jdGlvbiBzYXZlUG9zaXRpb25Ub0VzdGltYXRlKCkgewogICAgaWYgKCFzZWxlY3RlZENsaWVudCB8fCAhc2VsZWN0ZWRFc3RpbWF0ZSkgcmV0dXJuOwoKICAgIGNvbnN0IG5ld1BvczogUG9zaXRpb24gPSB7CiAgICAgIC4uLnBvc0RyYWZ0LAogICAgICBpZDogdWlkKCksCiAgICAgIHdpZHRoTW06IGNsYW1wTnVtKE1hdGgucm91bmQocG9zRHJhZnQud2lkdGhNbSB8fCAwKSwgMzAwLCA2MDAwKSwKICAgICAgaGVpZ2h0TW06IGNsYW1wTnVtKE1hdGgucm91bmQocG9zRHJhZnQuaGVpZ2h0TW0gfHwgMCksIDMwMCwgNjAwMCksCiAgICAgIGZpZWxkc1g6IGNsYW1wTnVtKE1hdGgucm91bmQocG9zRHJhZnQuZmllbGRzWCB8fCAxKSwgMSwgMTYpLAogICAgICBmaWVsZHNZOiBjbGFtcE51bShNYXRoLnJvdW5kKHBvc0RyYWZ0LmZpZWxkc1kgfHwgMSksIDEsIDE2KSwKICAgIH07CgogICAgc2V0Q2xpZW50cygocHJldikgPT4KICAgICAgcHJldi5tYXAoKGMpID0+IHsKICAgICAgICBpZiAoYy5pZCAhPT0gc2VsZWN0ZWRDbGllbnQuaWQpIHJldHVybiBjOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAuLi5jLAogICAgICAgICAgZXN0aW1hdGVzOiBjLmVzdGltYXRlcy5tYXAoKGUpID0+IHsKICAgICAgICAgICAgaWYgKGUuaWQgIT09IHNlbGVjdGVkRXN0aW1hdGUuaWQpIHJldHVybiBlOwogICAgICAgICAgICByZXR1cm4geyAuLi5lLCBwb3NpdGlvbnM6IFtuZXdQb3MsIC4uLmUucG9zaXRpb25zXSB9OwogICAgICAgICAgfSksCiAgICAgICAgfTsKICAgICAgfSkKICAgICk7CgogICAgc2V0U2hvd1Bvc2l0aW9uV2l6YXJkKGZhbHNlKTsKICAgIHNldFBvc1N0ZXAoMSk7CiAgfQoKICBmdW5jdGlvbiBzdGVwTGFiZWwoczogMSB8IDIgfCAzKSB7CiAgICByZXR1cm4gcyA9PT0gMSA/ICJQb3NpdGlvbiIgOiBzID09PSAyID8gIkRpbWVuc2lvbnMiIDogIkNvbmZpZ3VyYXRpb24iOwogIH0KCiAgZnVuY3Rpb24gZWZmZWN0aXZlRGVmYXVsdHNGb3JQb3NpdGlvbihlc3Q6IEVzdGltYXRlLCBwb3M6IFBvc2l0aW9uKTogRXN0aW1hdGVEZWZhdWx0cyB7CiAgICBpZiAocG9zLnVzZUVzdGltYXRlRGVmYXVsdHMpIHJldHVybiBlc3QuZGVmYXVsdHM7CiAgICAvLyBtZXJnZSBlc3RpbWF0ZSBkZWZhdWx0cyArIG92ZXJyaWRlcwogICAgcmV0dXJuIHsgLi4uZXN0LmRlZmF1bHRzLCAuLi5wb3Mub3ZlcnJpZGVzIH07CiAgfQoKICBmdW5jdGlvbiBzZXRFc3RpbWF0ZURlZmF1bHRzKG5leHQ6IEVzdGltYXRlRGVmYXVsdHMpIHsKICAgIGlmICghc2VsZWN0ZWRDbGllbnQgfHwgIXNlbGVjdGVkRXN0aW1hdGUpIHJldHVybjsKICAgIHNldENsaWVudHMoKHByZXYpID0+CiAgICAgIHByZXYubWFwKChjKSA9PiB7CiAgICAgICAgaWYgKGMuaWQgIT09IHNlbGVjdGVkQ2xpZW50LmlkKSByZXR1cm4gYzsKICAgICAgICByZXR1cm4gewogICAgICAgICAgLi4uYywKICAgICAgICAgIGVzdGltYXRlczogYy5lc3RpbWF0ZXMubWFwKChlKSA9PiAoZS5pZCA9PT0gc2VsZWN0ZWRFc3RpbWF0ZS5pZCA/IHsgLi4uZSwgZGVmYXVsdHM6IG5leHQgfSA6IGUpKSwKICAgICAgICB9OwogICAgICB9KQogICAgKTsKICB9CgogIGZ1bmN0aW9uIHNldFBvc2l0aW9uRGVmYXVsdHNPdmVycmlkZShuZXh0OiBFc3RpbWF0ZURlZmF1bHRzKSB7CiAgICAvLyBzdG9yZSBvbmx5IGFzIG92ZXJyaWRlcyAoZGlmZmVyZW5jZXMgYXJlIGZpbmUgbGF0ZXI7IGZvciBub3cgc3RvcmUgZnVsbCkKICAgIHNldFBvc0RyYWZ0KChwKSA9PiAoewogICAgICAuLi5wLAogICAgICBvdmVycmlkZXM6IHsKICAgICAgICAuLi5uZXh0LAogICAgICB9LAogICAgfSkpOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlQ2xpZW50KHR5cGU6IENsaWVudFR5cGUpIHsKICAgIGNvbnN0IG5ld0NsaWVudDogQ2xpZW50ID0gewogICAgICBpZDogdWlkKCksCiAgICAgIHR5cGUsCiAgICAgIGNsaWVudFJlZjogbmV4dENsaWVudFJlZihjbGllbnRDb3VudGVyKSwKICAgICAgY2xpZW50TmFtZTogdHlwZSA9PT0gIkluZGl2aWR1YWwiID8gZHJhZnRDbGllbnROYW1lLnRyaW0oKSA6IGRyYWZ0QnVzaW5lc3NOYW1lLnRyaW0oKSwKICAgICAgZW1haWw6IGRyYWZ0RW1haWwudHJpbSgpLAogICAgICBtb2JpbGU6IGRyYWZ0TW9iaWxlLnRyaW0oKSwKICAgICAgaG9tZTogZHJhZnRIb21lLnRyaW0oKSwKICAgICAgcHJvamVjdE5hbWU6ICIiLAogICAgICBwcm9qZWN0QWRkcmVzczogREVGQVVMVF9DVVNUT01FUl9BRERSRVNTLAogICAgICBpbnZvaWNlQWRkcmVzczogREVGQVVMVF9DVVNUT01FUl9BRERSRVNTLAogICAgICBidXNpbmVzc05hbWU6IHR5cGUgPT09ICJCdXNpbmVzcyIgPyBkcmFmdEJ1c2luZXNzTmFtZS50cmltKCkgOiB1bmRlZmluZWQsCiAgICAgIGNvbnRhY3RQZXJzb246ICIiLAogICAgICBlc3RpbWF0ZXM6IFtdLAogICAgfTsKCiAgICBzZXRDbGllbnRzKChwcmV2KSA9PiBbbmV3Q2xpZW50LCAuLi5wcmV2XSk7CiAgICBzZXRDbGllbnRDb3VudGVyKChuKSA9PiBuICsgMSk7CgogICAgc2V0U2hvd0FkZENsaWVudChmYWxzZSk7CiAgICBzZXREcmFmdENsaWVudE5hbWUoIiIpOwogICAgc2V0RHJhZnRCdXNpbmVzc05hbWUoIiIpOwogICAgc2V0RHJhZnRFbWFpbCgiIik7CiAgICBzZXREcmFmdE1vYmlsZSgiIik7CiAgICBzZXREcmFmdEhvbWUoIiIpOwogIH0KCiAgcmV0dXJuICgKICAgIDxkaXYgc3R5bGU9e3sgZm9udEZhbWlseTogInN5c3RlbS11aSwgLWFwcGxlLXN5c3RlbSwgU2Vnb2UgVUksIFJvYm90bywgQXJpYWwsIHNhbnMtc2VyaWYiLCBiYWNrZ3JvdW5kOiAiI2Y0ZjRmNSIsIG1pbkhlaWdodDogIjEwMHZoIiB9fT4KICAgICAgPGRpdiBzdHlsZT17eyB3aWR0aDogIjEwMCUiLCBtYXJnaW46ICIwIiwgcGFkZGluZzogMTYgfX0+CiAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZ3JpZCIsIGdyaWRUZW1wbGF0ZUNvbHVtbnM6ICIyODBweCAxZnIiLCBnYXA6IDE2IH19PgogICAgICAgICAgey8qIFNpZGViYXIgKi99CiAgICAgICAgICA8Q2FyZCBzdHlsZT17eyBwYWRkaW5nOiAxMiB9fT4KICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBwYWRkaW5nOiAiNnB4IDZweCAxMnB4IDZweCIgfX0+CiAgICAgICAgICAgICAgPGltZwogICAgICAgICAgICAgICAgc3JjPSIvcXVvdGVzeW5jLWxvZ28ucG5nIgogICAgICAgICAgICAgICAgYWx0PSJRdW90ZVN5bmMiCiAgICAgICAgICAgICAgICBzdHlsZT17ewogICAgICAgICAgICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgICAgICAgICAgICBtYXhXaWR0aDogMjYwLAogICAgICAgICAgICAgICAgICBoZWlnaHQ6IDc4LAogICAgICAgICAgICAgICAgICBvYmplY3RGaXQ6ICJjb250YWluIiwKICAgICAgICAgICAgICAgICAgZGlzcGxheTogImJsb2NrIiwKICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IG1hcmdpblRvcDogMTQgfX0+CiAgICAgICAgICAgICAgPEgzPkN1c3RvbWVyczwvSDM+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDggfX0+CiAgICAgICAgICAgICAgICA8U2lkZWJhckl0ZW0gbGFiZWw9IkJ1c2luZXNzIEN1c3RvbWVycyIgYWN0aXZlPXttZW51ID09PSAiY3VzdG9tZXJzX2J1c2luZXNzIn0gb25DbGljaz17KCkgPT4gc2VsZWN0TWVudSgiY3VzdG9tZXJzX2J1c2luZXNzIil9IC8+CiAgICAgICAgICAgICAgICA8U2lkZWJhckl0ZW0gbGFiZWw9IkluZGl2aWR1YWwgQ3VzdG9tZXJzIiBhY3RpdmU9e21lbnUgPT09ICJjdXN0b21lcnNfaW5kaXZpZHVhbCJ9IG9uQ2xpY2s9eygpID0+IHNlbGVjdE1lbnUoImN1c3RvbWVyc19pbmRpdmlkdWFsIil9IC8+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDE0IH19PgogICAgICAgICAgICAgIDxIMz5QcmVmZXJlbmNlczwvSDM+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDggfX0+CiAgICAgICAgICAgICAgICA8U2lkZWJhckl0ZW0gbGFiZWw9IlByb2plY3QgUHJlZmVyZW5jZXMiIGFjdGl2ZT17bWVudSA9PT0gInByb2plY3RfcHJlZmVyZW5jZXMifSBvbkNsaWNrPXsoKSA9PiBzZWxlY3RNZW51KCJwcm9qZWN0X3ByZWZlcmVuY2VzIil9IC8+CiAgICAgICAgICAgICAgICA8U2lkZWJhckl0ZW0gbGFiZWw9IkFkZHJlc3MgRGF0YWJhc2UiIGFjdGl2ZT17bWVudSA9PT0gImFkZHJlc3NfZGF0YWJhc2UifSBvbkNsaWNrPXsoKSA9PiBzZWxlY3RNZW51KCJhZGRyZXNzX2RhdGFiYXNlIil9IC8+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDE0IH19PgogICAgICAgICAgICAgIDxIMz5Ub29sczwvSDM+CiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDggfX0+CiAgICAgICAgICAgICAgICA8U2lkZWJhckl0ZW0gbGFiZWw9IlJlcG9ydHMiIGFjdGl2ZT17bWVudSA9PT0gInJlcG9ydHMifSBvbkNsaWNrPXsoKSA9PiBzZWxlY3RNZW51KCJyZXBvcnRzIil9IC8+CiAgICAgICAgICAgICAgICA8U2lkZWJhckl0ZW0gbGFiZWw9IkNBRCBEcmF3aW5nIiBhY3RpdmU9e21lbnUgPT09ICJjYWRfZHJhd2luZyJ9IG9uQ2xpY2s9eygpID0+IHNlbGVjdE1lbnUoImNhZF9kcmF3aW5nIil9IC8+CiAgICAgICAgICAgICAgICA8U2lkZWJhckl0ZW0gbGFiZWw9IlJlbW90ZSBTdXBwb3J0IiBhY3RpdmU9e21lbnUgPT09ICJyZW1vdGVfc3VwcG9ydCJ9IG9uQ2xpY2s9eygpID0+IHNlbGVjdE1lbnUoInJlbW90ZV9zdXBwb3J0Iil9IC8+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9DYXJkPgoKICAgICAgICAgIHsvKiBNYWluICovfQogICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZ3JpZCIsIGdhcDogMTYgfX0+CiAgICAgICAgICAgIHsvKiBDVVNUT01FUlMgTElTVCAqL30KICAgICAgICAgICAgeyhtZW51ID09PSAiY3VzdG9tZXJzX2J1c2luZXNzIiB8fCBtZW51ID09PSAiY3VzdG9tZXJzX2luZGl2aWR1YWwiKSAmJiB2aWV3ID09PSAiY3VzdG9tZXJzIiAmJiAoCiAgICAgICAgICAgICAgPENhcmQgc3R5bGU9e3sgbWluSGVpZ2h0OiA1MjAgfX0+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGRpc3BsYXk6ICJmbGV4IiwgYWxpZ25JdGVtczogImZsZXgtc3RhcnQiLCBqdXN0aWZ5Q29udGVudDogInNwYWNlLWJldHdlZW4iLCBnYXA6IDEyIH19PgogICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgIDxIMj57bWVudSA9PT0gImN1c3RvbWVyc19idXNpbmVzcyIgPyAiQnVzaW5lc3MgQ3VzdG9tZXJzIiA6ICJJbmRpdmlkdWFsIEN1c3RvbWVycyJ9PC9IMj4KICAgICAgICAgICAgICAgICAgICA8U21hbGw+T3BlbiBhIGNsaWVudCB0byBjaG9vc2UgYW4gZXN0aW1hdGUgKG9yIGNyZWF0ZSBvbmUpLjwvU21hbGw+CiAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgPEJ1dHRvbiB2YXJpYW50PSJwcmltYXJ5IiBvbkNsaWNrPXsoKSA9PiBzZXRTaG93QWRkQ2xpZW50KHRydWUpfT4KICAgICAgICAgICAgICAgICAgICBBZGQgQ2xpZW50CiAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAge3Nob3dBZGRDbGllbnQgJiYgKAogICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IG1hcmdpblRvcDogMTQsIGJvcmRlclJhZGl1czogMTYsIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwgcGFkZGluZzogMTIsIGJhY2tncm91bmQ6ICIjZmZmIiB9fT4KICAgICAgICAgICAgICAgICAgICA8SDM+QWRkIHttZW51ID09PSAiY3VzdG9tZXJzX2J1c2luZXNzIiA/ICJCdXNpbmVzcyIgOiAiSW5kaXZpZHVhbCJ9IENsaWVudDwvSDM+CgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgbWFyZ2luVG9wOiAxMCwgZGlzcGxheTogImdyaWQiLCBnYXA6IDEyIH19PgogICAgICAgICAgICAgICAgICAgICAge21lbnUgPT09ICJjdXN0b21lcnNfYnVzaW5lc3MiID8gKAogICAgICAgICAgICAgICAgICAgICAgICA8PgogICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXtsYWJlbFN0eWxlfT5CdXNpbmVzcyBuYW1lPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8SW5wdXQgdmFsdWU9e2RyYWZ0QnVzaW5lc3NOYW1lfSBvbkNoYW5nZT17c2V0RHJhZnRCdXNpbmVzc05hbWV9IHBsYWNlaG9sZGVyPSJFY29mZW5zdGVyIEx0ZCIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC8+CiAgICAgICAgICAgICAgICAgICAgICApIDogKAogICAgICAgICAgICAgICAgICAgICAgICA8PgogICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXtsYWJlbFN0eWxlfT5DbGllbnQgbmFtZTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPElucHV0IHZhbHVlPXtkcmFmdENsaWVudE5hbWV9IG9uQ2hhbmdlPXtzZXREcmFmdENsaWVudE5hbWV9IHBsYWNlaG9sZGVyPSJOYW1lIiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8Lz4KICAgICAgICAgICAgICAgICAgICAgICl9CgogICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZ3JpZCIsIGdyaWRUZW1wbGF0ZUNvbHVtbnM6ICIxZnIgMWZyIiwgZ2FwOiAxMiB9fT4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXtsYWJlbFN0eWxlfT5FbWFpbDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgIDxJbnB1dCB2YWx1ZT17ZHJhZnRFbWFpbH0gb25DaGFuZ2U9e3NldERyYWZ0RW1haWx9IHBsYWNlaG9sZGVyPSJlbWFpbEBleGFtcGxlLmNvbSIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17bGFiZWxTdHlsZX0+TW9iaWxlPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPElucHV0IHZhbHVlPXtkcmFmdE1vYmlsZX0gb25DaGFuZ2U9e3NldERyYWZ0TW9iaWxlfSBwbGFjZWhvbGRlcj0iMDcuLi4iIC8+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17bGFiZWxTdHlsZX0+SG9tZTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8SW5wdXQgdmFsdWU9e2RyYWZ0SG9tZX0gb25DaGFuZ2U9e3NldERyYWZ0SG9tZX0gcGxhY2Vob2xkZXI9IjAxLi4uIiAvPgogICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZmxleCIsIGdhcDogOCwgbWFyZ2luVG9wOiA2IH19PgogICAgICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIHZhcmlhbnQ9InNlY29uZGFyeSIgb25DbGljaz17KCkgPT4gc2V0U2hvd0FkZENsaWVudChmYWxzZSl9PgogICAgICAgICAgICAgICAgICAgICAgICAgIENhbmNlbAogICAgICAgICAgICAgICAgICAgICAgICA8L0J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPEJ1dHRvbiB2YXJpYW50PSJwcmltYXJ5IiBvbkNsaWNrPXsoKSA9PiBjcmVhdGVDbGllbnQobWVudSA9PT0gImN1c3RvbWVyc19idXNpbmVzcyIgPyAiQnVzaW5lc3MiIDogIkluZGl2aWR1YWwiKX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgQ3JlYXRlIENsaWVudAogICAgICAgICAgICAgICAgICAgICAgICA8L0J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICl9CgogICAgICAgICAgICAgICAgey8qIEN1c3RvbWVycyBsaXN0ICovfQogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDEyLCBkaXNwbGF5OiAiZ3JpZCIsIGdhcDogMTIgfX0+CiAgICAgICAgICAgICAgICAgIHtmaWx0ZXJlZENsaWVudHMubGVuZ3RoID09PSAwICYmIDxkaXYgc3R5bGU9e3sgZm9udFNpemU6IDEzLCBjb2xvcjogIiM3MTcxN2EiIH19Pk5vIGNsaWVudHMgeWV0LjwvZGl2Pn0KCiAgICAgICAgICAgICAgICAgIHtmaWx0ZXJlZENsaWVudHMubWFwKChjKSA9PiAoCiAgICAgICAgICAgICAgICAgICAgPGRpdgogICAgICAgICAgICAgICAgICAgICAga2V5PXtjLmlkfQogICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3sKICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAxNiwKICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiAiMXB4IHNvbGlkICNlNGU0ZTciLAogICAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAxMiwKICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogIiNmZmYiLAogICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAiZ3JpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGdhcDogOCwKICAgICAgICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZmxleCIsIGFsaWduSXRlbXM6ICJjZW50ZXIiLCBqdXN0aWZ5Q29udGVudDogInNwYWNlLWJldHdlZW4iLCBnYXA6IDEwIH19PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGRpc3BsYXk6ICJmbGV4IiwgYWxpZ25JdGVtczogImNlbnRlciIsIGdhcDogMTAsIGZsZXhXcmFwOiAid3JhcCIgfX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPEgzPntjLmNsaWVudE5hbWV9PC9IMz4KICAgICAgICAgICAgICAgICAgICAgICAgICA8UGlsbD57Yy5jbGllbnRSZWZ9PC9QaWxsPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxTbWFsbD57Yy5lc3RpbWF0ZXMubGVuZ3RofSBlc3RpbWF0ZXM8L1NtYWxsPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBnYXA6IDEwIH19PgogICAgICAgICAgICAgICAgICAgICAgICAgIDxCdXR0b24gdmFyaWFudD0icHJpbWFyeSIgb25DbGljaz17KCkgPT4gb3BlbkNsaWVudChjKX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPcGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9CdXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPEJ1dHRvbiB2YXJpYW50PSJzZWNvbmRhcnkiIG9uQ2xpY2s9eygpID0+IGNyZWF0ZUVzdGltYXRlRm9yQ2xpZW50KGMpfT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5ldyBFc3RpbWF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZm9udFNpemU6IDEyLCBjb2xvcjogIiM3MTcxN2EiIH19PgogICAgICAgICAgICAgICAgICAgICAgICB7Yy5wcm9qZWN0TmFtZSB8fCAiTm8gcHJvamVjdCBuYW1lIn0g4oCiIHtjLnByb2plY3RBZGRyZXNzID8gYy5wcm9qZWN0QWRkcmVzcy5zcGxpdCgiXG4iKVswXSA6ICJObyBwcm9qZWN0IGFkZHJlc3MifQogICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICkpfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9DYXJkPgogICAgICAgICAgICApfQoKICAgICAgICAgICAgey8qIEVTVElNQVRFIFBJQ0tFUiAqL30KICAgICAgICAgICAge3ZpZXcgPT09ICJlc3RpbWF0ZV9waWNrZXIiICYmIHBpY2tlckNsaWVudCAmJiAoCiAgICAgICAgICAgICAgPENhcmQgc3R5bGU9e3sgbWluSGVpZ2h0OiA1MjAgfX0+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGRpc3BsYXk6ICJmbGV4IiwgYWxpZ25JdGVtczogImZsZXgtc3RhcnQiLCBqdXN0aWZ5Q29udGVudDogInNwYWNlLWJldHdlZW4iLCBnYXA6IDEyIH19PgogICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgIDxIMj5DaG9vc2UgYW4gZXN0aW1hdGU8L0gyPgogICAgICAgICAgICAgICAgICAgIDxTbWFsbD57cGlja2VyQ2xpZW50LmNsaWVudE5hbWV9IOKAoiB7cGlja2VyQ2xpZW50LmNsaWVudFJlZn08L1NtYWxsPgogICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBnYXA6IDEwIH19PgogICAgICAgICAgICAgICAgICAgIDxCdXR0b24gdmFyaWFudD0ic2Vjb25kYXJ5IiBvbkNsaWNrPXsoKSA9PiBzZXRWaWV3KCJjdXN0b21lcnMiKX0+QmFjazwvQnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxCdXR0b24gdmFyaWFudD0icHJpbWFyeSIgb25DbGljaz17KCkgPT4gY3JlYXRlRXN0aW1hdGVGb3JDbGllbnQocGlja2VyQ2xpZW50KX0+TmV3IEVzdGltYXRlPC9CdXR0b24+CiAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDE0LCBkaXNwbGF5OiAiZ3JpZCIsIGdhcDogMTAgfX0+CiAgICAgICAgICAgICAgICAgIHtwaWNrZXJDbGllbnQuZXN0aW1hdGVzLm1hcCgoZSkgPT4gKAogICAgICAgICAgICAgICAgICAgIDxkaXYKICAgICAgICAgICAgICAgICAgICAgIGtleT17ZS5pZH0KICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7CiAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogMTQsCiAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwKICAgICAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMTAsCiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICIjZmZmIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogImZsZXgiLAogICAgICAgICAgICAgICAgICAgICAgICBqdXN0aWZ5Q29udGVudDogInNwYWNlLWJldHdlZW4iLAogICAgICAgICAgICAgICAgICAgICAgICBhbGlnbkl0ZW1zOiAiY2VudGVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgZ2FwOiAxMCwKICAgICAgICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZmxleCIsIGFsaWduSXRlbXM6ICJjZW50ZXIiLCBnYXA6IDgsIGZsZXhXcmFwOiAid3JhcCIgfX0+CiAgICAgICAgICAgICAgICAgICAgICAgIDxQaWxsPntlLmVzdGltYXRlUmVmfTwvUGlsbD4KICAgICAgICAgICAgICAgICAgICAgICAgPFNtYWxsPntlLnN0YXR1c308L1NtYWxsPgogICAgICAgICAgICAgICAgICAgICAgICA8U21hbGw+e2UucG9zaXRpb25zLmxlbmd0aH0gcG9zaXRpb25zPC9TbWFsbD4KICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgIDxCdXR0b24gdmFyaWFudD0icHJpbWFyeSIgb25DbGljaz17KCkgPT4gb3BlbkVzdGltYXRlRnJvbVBpY2tlcihlLmlkKX0+T3BlbjwvQnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDwvQ2FyZD4KICAgICAgICAgICAgKX0KCiAgICAgICAgICAgIHsvKiBFU1RJTUFURSBERUZBVUxUUyAoU3VwcGxpZXIgJiBQcm9kdWN0IERlZmF1bHRzIHNjcmVlbikgKi99CiAgICAgICAgICAgIHt2aWV3ID09PSAiZXN0aW1hdGVfZGVmYXVsdHMiICYmIHNlbGVjdGVkQ2xpZW50ICYmIHNlbGVjdGVkRXN0aW1hdGUgJiYgKAogICAgICAgICAgICAgIDxDYXJkIHN0eWxlPXt7IG1pbkhlaWdodDogNTIwIH19PgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZmxleCIsIGFsaWduSXRlbXM6ICJmbGV4LXN0YXJ0IiwganVzdGlmeUNvbnRlbnQ6ICJzcGFjZS1iZXR3ZWVuIiwgZ2FwOiAxMiB9fT4KICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICA8SDI+U3VwcGxpZXIgJiBQcm9kdWN0IERlZmF1bHRzPC9IMj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IG1hcmdpblRvcDogOCwgZGlzcGxheTogImZsZXgiLCBnYXA6IDgsIGZsZXhXcmFwOiAid3JhcCIsIGFsaWduSXRlbXM6ICJjZW50ZXIiIH19PgogICAgICAgICAgICAgICAgICAgICAgPFBpbGw+e3NlbGVjdGVkQ2xpZW50LmNsaWVudFJlZn08L1BpbGw+CiAgICAgICAgICAgICAgICAgICAgICA8UGlsbD57c2VsZWN0ZWRFc3RpbWF0ZS5lc3RpbWF0ZVJlZn08L1BpbGw+CiAgICAgICAgICAgICAgICAgICAgICA8U21hbGw+e3NlbGVjdGVkQ2xpZW50LmNsaWVudE5hbWV9PC9TbWFsbD4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8U21hbGw+U2V0IGVzdGltYXRlLWxldmVsIGRlZmF1bHRzIGhlcmUuIEFkZCBQb3NpdGlvbiB3aWxsIHVzZSB0aGVzZSB3aGVuIOKAnFVzZSBlc3RpbWF0ZSBkZWZhdWx0c+KAnSBpcyBvbi48L1NtYWxsPgogICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBnYXA6IDEwIH19PgogICAgICAgICAgICAgICAgICAgIDxCdXR0b24gdmFyaWFudD0ic2Vjb25kYXJ5IiBvbkNsaWNrPXsoKSA9PiBzZXRWaWV3KCJjdXN0b21lcnMiKX0+QmFjazwvQnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxCdXR0b24gdmFyaWFudD0icHJpbWFyeSIgb25DbGljaz17KCkgPT4gc2V0VmlldygiZXN0aW1hdGVfd29ya3NwYWNlIil9PkNvbnRpbnVlPC9CdXR0b24+CiAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDE0IH19PgogICAgICAgICAgICAgICAgICA8RGVmYXVsdHNFZGl0b3IKICAgICAgICAgICAgICAgICAgICB0aXRsZT0iRXN0aW1hdGUgRGVmYXVsdHMiCiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdFR5cGU9e3NlbGVjdGVkRXN0aW1hdGUuZGVmYXVsdHMucHJvZHVjdFR5cGV9CiAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3NlbGVjdGVkRXN0aW1hdGUuZGVmYXVsdHN9CiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3NldEVzdGltYXRlRGVmYXVsdHN9CiAgICAgICAgICAgICAgICAgICAgc2hvd0Rvb3JPcHRpb25zPXt0cnVlfQogICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9DYXJkPgogICAgICAgICAgICApfQoKICAgICAgICAgICAgey8qIEVTVElNQVRFIFdPUktTUEFDRSAqL30KICAgICAgICAgICAge3ZpZXcgPT09ICJlc3RpbWF0ZV93b3Jrc3BhY2UiICYmIHNlbGVjdGVkQ2xpZW50ICYmIHNlbGVjdGVkRXN0aW1hdGUgJiYgKAogICAgICAgICAgICAgIDxDYXJkIHN0eWxlPXt7IG1pbkhlaWdodDogNTIwLCBkaXNwbGF5OiAiZmxleCIsIGZsZXhEaXJlY3Rpb246ICJjb2x1bW4iIH19PgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZmxleCIsIGFsaWduSXRlbXM6ICJmbGV4LXN0YXJ0IiwganVzdGlmeUNvbnRlbnQ6ICJzcGFjZS1iZXR3ZWVuIiwgZ2FwOiAxMiB9fT4KICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICA8SDI+RXN0aW1hdGU8L0gyPgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgbWFyZ2luVG9wOiA4LCBkaXNwbGF5OiAiZmxleCIsIGdhcDogOCwgZmxleFdyYXA6ICJ3cmFwIiwgYWxpZ25JdGVtczogImNlbnRlciIgfX0+CiAgICAgICAgICAgICAgICAgICAgICA8UGlsbD57c2VsZWN0ZWRDbGllbnQuY2xpZW50UmVmfTwvUGlsbD4KICAgICAgICAgICAgICAgICAgICAgIDxQaWxsPntzZWxlY3RlZEVzdGltYXRlLmVzdGltYXRlUmVmfTwvUGlsbD4KICAgICAgICAgICAgICAgICAgICAgIDxTbWFsbD57c2VsZWN0ZWRDbGllbnQuY2xpZW50TmFtZX08L1NtYWxsPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxTbWFsbD5TdXBwbGllci9Qcm9kdWN0IERlZmF1bHRzIGFyZSBzZXQgc2VwYXJhdGVseS4gQWRkIFBvc2l0aW9uIHN0YXJ0cyBhdCBQb3NpdGlvbiDihpIgRGltZW5zaW9ucyDihpIgQ29uZmlndXJhdGlvbi48L1NtYWxsPgogICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBnYXA6IDEwIH19PgogICAgICAgICAgICAgICAgICAgIDxCdXR0b24gdmFyaWFudD0ic2Vjb25kYXJ5IiBvbkNsaWNrPXsoKSA9PiBzZXRWaWV3KCJlc3RpbWF0ZV9kZWZhdWx0cyIpfT5TdXBwbGllciAmIFByb2R1Y3QgRGVmYXVsdHM8L0J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIHZhcmlhbnQ9InNlY29uZGFyeSIgb25DbGljaz17KCkgPT4gc2V0VmlldygiY3VzdG9tZXJzIil9PkJhY2s8L0J1dHRvbj4KICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IG1hcmdpblRvcDogMTYgfX0+CiAgICAgICAgICAgICAgICAgIDxCdXR0b24gdmFyaWFudD0icHJpbWFyeSIgb25DbGljaz17c3RhcnRBZGRQb3NpdGlvbn0gc3R5bGU9e3sgd2lkdGg6ICIxMDAlIiB9fT4KICAgICAgICAgICAgICAgICAgICBBZGQgUG9zaXRpb24KICAgICAgICAgICAgICAgICAgPC9CdXR0b24+CiAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IG1hcmdpblRvcDogMTYsIGJvcmRlclRvcDogIjFweCBzb2xpZCAjZTRlNGU3IiwgcGFkZGluZ1RvcDogMTIsIGZsZXg6IDEgfX0+CiAgICAgICAgICAgICAgICAgIDxIMz5Qb3NpdGlvbnM8L0gzPgogICAgICAgICAgICAgICAgICA8U21hbGw+UG9zaXRpb25zIGFkZGVkIHRvIHRoaXMgZXN0aW1hdGUgYXBwZWFyIGJlbG93LjwvU21hbGw+CgogICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IG1hcmdpblRvcDogMTAsIGRpc3BsYXk6ICJncmlkIiwgZ2FwOiAxMCB9fT4KICAgICAgICAgICAgICAgICAgICB7c2VsZWN0ZWRFc3RpbWF0ZS5wb3NpdGlvbnMubGVuZ3RoID09PSAwICYmIDxkaXYgc3R5bGU9e3sgZm9udFNpemU6IDEzLCBjb2xvcjogIiM3MTcxN2EiIH19Pk5vIHBvc2l0aW9ucyB5ZXQuPC9kaXY+fQoKICAgICAgICAgICAgICAgICAgICB7c2VsZWN0ZWRFc3RpbWF0ZS5wb3NpdGlvbnMubWFwKChwKSA9PiAoCiAgICAgICAgICAgICAgICAgICAgICA8ZGl2CiAgICAgICAgICAgICAgICAgICAgICAgIGtleT17cC5pZH0KICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3sKICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6IDE0LAogICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwKICAgICAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAxMCwKICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAiI2ZmZiIsCiAgICAgICAgICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBhbGlnbkl0ZW1zOiAiY2VudGVyIiwganVzdGlmeUNvbnRlbnQ6ICJzcGFjZS1iZXR3ZWVuIiwgZ2FwOiAxMCB9fT4KICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGZvbnRXZWlnaHQ6IDkwMCwgZm9udFNpemU6IDEzIH19PntwLnBvc2l0aW9uUmVmfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZm9udFNpemU6IDEyLCBjb2xvcjogIiM3MTcxN2EiIH19PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgUXR5IHtwLnF0eX0g4oCiIHtwLndpZHRoTW19w5d7cC5oZWlnaHRNbX0g4oCiIHtwLmZpZWxkc1h9w5d7cC5maWVsZHNZfQogICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDQsIGZvbnRTaXplOiAxMiwgY29sb3I6ICIjNzE3MTdhIiB9fT4KICAgICAgICAgICAgICAgICAgICAgICAgICB7cC5yb29tTmFtZSB8fCAi4oCUIn0g4oCiIHtwLnBvc2l0aW9uVHlwZX0g4oCiIHtwLnVzZUVzdGltYXRlRGVmYXVsdHMgPyAiVXNpbmcgZXN0aW1hdGUgZGVmYXVsdHMiIDogIk92ZXJyaWRlcyJ9CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgey8qIFBvc2l0aW9uIHdpemFyZCAqL30KICAgICAgICAgICAgICAgIHtzaG93UG9zaXRpb25XaXphcmQgJiYgc2VsZWN0ZWRFc3RpbWF0ZSAmJiAoCiAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgbWFyZ2luVG9wOiAxNCwgYm9yZGVyUmFkaXVzOiAxNCwgYm9yZGVyOiAiMXB4IHNvbGlkICNlNGU0ZTciLCBwYWRkaW5nOiAxMiwgYmFja2dyb3VuZDogIiNmZmYiIH19PgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBhbGlnbkl0ZW1zOiAiY2VudGVyIiwganVzdGlmeUNvbnRlbnQ6ICJzcGFjZS1iZXR3ZWVuIiwgZ2FwOiAxMCB9fT4KICAgICAgICAgICAgICAgICAgICAgIDxIMz5BZGQgUG9zaXRpb248L0gzPgogICAgICAgICAgICAgICAgICAgICAgPEJ1dHRvbiB2YXJpYW50PSJzZWNvbmRhcnkiIG9uQ2xpY2s9eygpID0+IHNldFNob3dQb3NpdGlvbldpemFyZChmYWxzZSl9IHN0eWxlPXt7IGJvcmRlclJhZGl1czogMTQsIHBhZGRpbmc6ICI4cHggMTBweCIgfX0+CiAgICAgICAgICAgICAgICAgICAgICAgIENsb3NlCiAgICAgICAgICAgICAgICAgICAgICA8L0J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDEwLCBkaXNwbGF5OiAiZmxleCIsIGdhcDogOCwgZmxleFdyYXA6ICJ3cmFwIiB9fT4KICAgICAgICAgICAgICAgICAgICAgIHtbMSwgMiwgM10ubWFwKChzKSA9PiAoCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYKICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk9e3N9CiAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogMTQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXI6ICIxcHggc29saWQgIiArIChwb3NTdGVwID09PSBzID8gIiMxODE4MWIiIDogIiNlNGU0ZTciKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IHBvc1N0ZXAgPT09IHMgPyAiIzE4MTgxYiIgOiAiI2ZmZiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogcG9zU3RlcCA9PT0gcyA/ICIjZmZmIiA6ICIjM2YzZjQ2IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6ICI4cHggMTBweCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250U2l6ZTogMTQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250V2VpZ2h0OiA4MDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgfX0KICAgICAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAgICAgIHtzfS4ge3N0ZXBMYWJlbChzIGFzIGFueSl9CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgbWFyZ2luVG9wOiAxMiwgYm9yZGVyUmFkaXVzOiAxNCwgYm9yZGVyOiAiMXB4IHNvbGlkICNlNGU0ZTciLCBwYWRkaW5nOiAxMiB9fT4KICAgICAgICAgICAgICAgICAgICAgIHtwb3NTdGVwID09PSAxICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZ3JpZCIsIGdhcDogMTIgfX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZ3JpZCIsIGdyaWRUZW1wbGF0ZUNvbHVtbnM6ICIxZnIgMWZyIiwgZ2FwOiAxMiB9fT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e2xhYmVsU3R5bGV9PlBvc2l0aW9uIHJlZmVyZW5jZTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8SW5wdXQgdmFsdWU9e3Bvc0RyYWZ0LnBvc2l0aW9uUmVmfSBvbkNoYW5nZT17KHYpID0+IHNldFBvc0RyYWZ0KChwKSA9PiAoeyAuLi5wLCBwb3NpdGlvblJlZjogdiB9KSl9IC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e2xhYmVsU3R5bGV9PlF1YW50aXR5PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxJbnB1dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9Im51bWJlciIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17U3RyaW5nKHBvc0RyYWZ0LnF0eSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyh2KSA9PiBzZXRQb3NEcmFmdCgocCkgPT4gKHsgLi4ucCwgcXR5OiBNYXRoLm1heCgxLCBNYXRoLm1pbig5OTksIE51bWJlcih2IHx8IDEpKSkgfSkpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXtsYWJlbFN0eWxlfT5Sb29tIG5hbWU8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxJbnB1dCB2YWx1ZT17cG9zRHJhZnQucm9vbU5hbWV9IG9uQ2hhbmdlPXsodikgPT4gc2V0UG9zRHJhZnQoKHApID0+ICh7IC4uLnAsIHJvb21OYW1lOiB2IH0pKX0gLz4KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e2xhYmVsU3R5bGV9PlBvc2l0aW9uIHR5cGU8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzZWxlY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3Bvc0RyYWZ0LnBvc2l0aW9uVHlwZX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRQb3NEcmFmdCgocCkgPT4gKHsgLi4ucCwgcG9zaXRpb25UeXBlOiBlLnRhcmdldC52YWx1ZSBhcyAiV2luZG93IiB8ICJEb29yIiB9KSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7IHdpZHRoOiAiMTAwJSIsIGJvcmRlclJhZGl1czogMTIsIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwgcGFkZGluZzogIjEwcHggMTJweCIsIGZvbnRTaXplOiAxNCB9fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJXaW5kb3ciPldpbmRvdzwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJEb29yIj5Eb29yPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICApfQoKICAgICAgICAgICAgICAgICAgICAgIHtwb3NTdGVwID09PSAyICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZ3JpZCIsIGdhcDogMTIgfX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZ3JpZCIsIGdyaWRUZW1wbGF0ZUNvbHVtbnM6ICIxZnIgMWZyIiwgZ2FwOiAxMiB9fT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e2xhYmVsU3R5bGV9PlRvdGFsIHdpZHRoIChtbSk8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPElucHV0IHR5cGU9Im51bWJlciIgdmFsdWU9e1N0cmluZyhwb3NEcmFmdC53aWR0aE1tKX0gb25DaGFuZ2U9eyh2KSA9PiBzZXRQb3NEcmFmdCgocCkgPT4gKHsgLi4ucCwgd2lkdGhNbTogTnVtYmVyKHYgfHwgcC53aWR0aE1tKSB9KSl9IC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e2xhYmVsU3R5bGV9PlRvdGFsIGhlaWdodCAobW0pPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxJbnB1dCB0eXBlPSJudW1iZXIiIHZhbHVlPXtTdHJpbmcocG9zRHJhZnQuaGVpZ2h0TW0pfSBvbkNoYW5nZT17KHYpID0+IHNldFBvc0RyYWZ0KChwKSA9PiAoeyAuLi5wLCBoZWlnaHRNbTogTnVtYmVyKHYgfHwgcC5oZWlnaHRNbSkgfSkpfSAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImdyaWQiLCBncmlkVGVtcGxhdGVDb2x1bW5zOiAiMWZyIDFmciIsIGdhcDogMTIgfX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXtsYWJlbFN0eWxlfT5GaWVsZHMgKHdpZHRoKTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8SW5wdXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJudW1iZXIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e1N0cmluZyhwb3NEcmFmdC5maWVsZHNYKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KHYpID0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRQb3NEcmFmdCgocCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmeCA9IE1hdGgubWF4KDEsIE1hdGgubWluKDE2LCBOdW1iZXIodiB8fCAxKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzWDogZngsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sV2lkdGhzTW06IHNjYWxlU3BsaXRzVG9Ub3RhbChwLndpZHRoTW0sIHAuY29sV2lkdGhzTW0gPz8gW10sIGZ4KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsSW5zZXJ0aW9uczogbm9ybWFsaXplQ2VsbEluc2VydGlvbnMoZngsIHAuZmllbGRzWSwgcC5jZWxsSW5zZXJ0aW9ucywgcC5pbnNlcnRpb24pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e2xhYmVsU3R5bGV9PkZpZWxkcyAoaGVpZ2h0KTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8SW5wdXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJudW1iZXIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e1N0cmluZyhwb3NEcmFmdC5maWVsZHNZKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KHYpID0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRQb3NEcmFmdCgocCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmeSA9IE1hdGgubWF4KDEsIE1hdGgubWluKDE2LCBOdW1iZXIodiB8fCAxKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzWTogZnksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93SGVpZ2h0c01tOiBzY2FsZVNwbGl0c1RvVG90YWwocC5oZWlnaHRNbSwgcC5yb3dIZWlnaHRzTW0gPz8gW10sIGZ5KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsSW5zZXJ0aW9uczogbm9ybWFsaXplQ2VsbEluc2VydGlvbnMocC5maWVsZHNYLCBmeSwgcC5jZWxsSW5zZXJ0aW9ucywgcC5pbnNlcnRpb24pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICApfQoKICAgICAgICAgICAgICAgICAgICAgIHtwb3NTdGVwID09PSAzICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAiZ3JpZCIsIGdyaWRUZW1wbGF0ZUNvbHVtbnM6ICI0MjBweCAxZnIiLCBnYXA6IDE2IH19PgogICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogImdyaWQiLCBnYXA6IDEyIH19PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGJvcmRlclJhZGl1czogMTQsIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwgcGFkZGluZzogMTIgfX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxIMz5JbnNlcnRpb248L0gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IG1hcmdpblRvcDogOCB9fT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGRpc3BsYXk6ICJmbGV4IiwgYWxpZ25JdGVtczogImNlbnRlciIsIGp1c3RpZnlDb250ZW50OiAic3BhY2UtYmV0d2VlbiIsIGdhcDogMTAgfX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBmb250U2l6ZTogMTIsIGNvbG9yOiAiIzcxNzE3YSIgfX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZCBmaWVsZDogI3tkcmFmdFNlbGVjdGVkQ2VsbC5yb3cgKiBwb3NEcmFmdC5maWVsZHNYICsgZHJhZnRTZWxlY3RlZENlbGwuY29sICsgMX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGRpc3BsYXk6ICJmbGV4IiwgZ2FwOiA4LCBhbGlnbkl0ZW1zOiAiY2VudGVyIiB9fT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzZWxlY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e29wZW5pbmdTdGR9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0T3BlbmluZ1N0ZChlLnRhcmdldC52YWx1ZSBhcyBhbnkpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17eyBib3JkZXJSYWRpdXM6IDEwLCBib3JkZXI6ICIxcHggc29saWQgI2U0ZTRlNyIsIHBhZGRpbmc6ICI2cHggMTBweCIsIGZvbnRTaXplOiAxMiB9fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZT0iT3BlbmluZyBjb252ZW50aW9uIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJESU4iPkRJTjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJVSyI+VUs8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17cHJldmlld1ZpZXd9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0UHJldmlld1ZpZXcoZS50YXJnZXQudmFsdWUgYXMgYW55KX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3sgYm9yZGVyUmFkaXVzOiAxMCwgYm9yZGVyOiAiMXB4IHNvbGlkICNlNGU0ZTciLCBwYWRkaW5nOiAiNnB4IDEwcHgiLCBmb250U2l6ZTogMTIgfX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU9IlZpZXciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9Ikluc2lkZSI+SW5zaWRlPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9Ik91dHNpZGUiPk91dHNpZGU8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDggfX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3Bvc0RyYWZ0LmNlbGxJbnNlcnRpb25zW2tleUZvckNlbGwoZHJhZnRTZWxlY3RlZENlbGwuY29sLCBkcmFmdFNlbGVjdGVkQ2VsbC5yb3cpXSA/PyBwb3NEcmFmdC5pbnNlcnRpb259CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFBvc0RyYWZ0KChwKSA9PiAoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbEluc2VydGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnAuY2VsbEluc2VydGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBba2V5Rm9yQ2VsbChkcmFmdFNlbGVjdGVkQ2VsbC5jb2wsIGRyYWZ0U2VsZWN0ZWRDZWxsLnJvdyldOiBlLnRhcmdldC52YWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7IHdpZHRoOiAiMTAwJSIsIGJvcmRlclJhZGl1czogMTIsIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwgcGFkZGluZzogIjEwcHggMTJweCIsIGZvbnRTaXplOiAxNCB9fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24+Rml4ZWQ8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24+VHVybjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbj5UaWx0PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uPlRpbHQgJiBUdXJuPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uPlRvcCBIdW5nPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uPlNpZGUgSHVuZzwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbj5SZXZlcnNpYmxlPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGJvcmRlclJhZGl1czogMTQsIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwgcGFkZGluZzogMTIgfX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxIMz5Vc2UgZXN0aW1hdGUgZGVmYXVsdHM8L0gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IG1hcmdpblRvcDogMTAsIGRpc3BsYXk6ICJncmlkIiwgZ2FwOiAxMCB9fT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9e3sgZGlzcGxheTogImZsZXgiLCBhbGlnbkl0ZW1zOiAiY2VudGVyIiwgZ2FwOiA4LCBmb250U2l6ZTogMTQsIGZvbnRXZWlnaHQ6IDcwMCB9fT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJjaGVja2JveCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17cG9zRHJhZnQudXNlRXN0aW1hdGVEZWZhdWx0c30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRQb3NEcmFmdCgocCkgPT4gKHsgLi4ucCwgdXNlRXN0aW1hdGVEZWZhdWx0czogZS50YXJnZXQuY2hlY2tlZCB9KSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXNlIGVzdGltYXRlIGRlZmF1bHRzIGZvciB0aGlzIHBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8U21hbGw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXaGVuIHVudGlja2VkLCB5b3UgY2FuIG92ZXJyaWRlIHRoZSBzYW1lIGRlZmF1bHRzIGJlbG93IChzYW1lIG9wdGlvbiBzZXQgYXMg4oCcU3VwcGxpZXIgJiBQcm9kdWN0IERlZmF1bHRz4oCdKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L1NtYWxsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHshcG9zRHJhZnQudXNlRXN0aW1hdGVEZWZhdWx0cyAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxEZWZhdWx0c0VkaXRvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPSJQb3NpdGlvbiBPdmVycmlkZXMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdFR5cGU9eyhwb3NEcmFmdC5vdmVycmlkZXMucHJvZHVjdFR5cGUgYXMgUHJvZHVjdFR5cGUpIHx8IHNlbGVjdGVkRXN0aW1hdGUuZGVmYXVsdHMucHJvZHVjdFR5cGV9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnNlbGVjdGVkRXN0aW1hdGUuZGVmYXVsdHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5wb3NEcmFmdC5vdmVycmlkZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KG5leHQpID0+IHNldFBvc2l0aW9uRGVmYXVsdHNPdmVycmlkZShuZXh0KX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93RG9vck9wdGlvbnM9e3Bvc0RyYWZ0LnBvc2l0aW9uVHlwZSA9PT0gIkRvb3IifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGJvcmRlclJhZGl1czogMTQsIGJvcmRlcjogIjFweCBzb2xpZCAjZTRlNGU3IiwgcGFkZGluZzogMTIgfX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGRpc3BsYXk6ICJmbGV4IiwgYWxpZ25JdGVtczogImNlbnRlciIsIGp1c3RpZnlDb250ZW50OiAic3BhY2UtYmV0d2VlbiIsIGdhcDogMTAgfX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxIMz5QcmV2aWV3PC9IMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFBpbGw+e3Bvc0RyYWZ0Lmluc2VydGlvbn08L1BpbGw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IG1hcmdpblRvcDogMTIgfX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxHcmlkRWRpdG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zPXt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aE1tOiBwb3NEcmFmdC53aWR0aE1tLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0TW06IHBvc0RyYWZ0LmhlaWdodE1tLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzWDogcG9zRHJhZnQuZmllbGRzWCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkc1k6IHBvc0RyYWZ0LmZpZWxkc1ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRpb246IHBvc0RyYWZ0Lmluc2VydGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxJbnNlcnRpb25zOiBwb3NEcmFmdC5jZWxsSW5zZXJ0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbFdpZHRoc01tOiBwb3NEcmFmdC5jb2xXaWR0aHNNbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd0hlaWdodHNNbTogcG9zRHJhZnQucm93SGVpZ2h0c01tLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRDZWxsPXtkcmFmdFNlbGVjdGVkQ2VsbH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblNlbGVjdENlbGw9e3NldERyYWZ0U2VsZWN0ZWRDZWxsfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXc9e3ByZXZpZXdWaWV3fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5pbmdTdGQ9e29wZW5pbmdTdGR9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0UG9zPXsoZm46IGFueSkgPT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFBvc0RyYWZ0KChwKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHQgPSBmbihwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZW5zdXJlIG5ldyBmaWVsZHMgZ2V0IGEgZGVmYXVsdCBpbnNlcnRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2VsbEluc2VydGlvbnMgPSBub3JtYWxpemVDZWxsSW5zZXJ0aW9ucygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0LmZpZWxkc1ggPz8gcC5maWVsZHNYLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHQuZmllbGRzWSA/PyBwLmZpZWxkc1ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dC5jZWxsSW5zZXJ0aW9ucyA/PyBwLmNlbGxJbnNlcnRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChuZXh0Lmluc2VydGlvbiA/PyBwLmluc2VydGlvbikgYXMgYW55CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IC4uLnAsIC4uLm5leHQsIGNlbGxJbnNlcnRpb25zIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgbWFyZ2luVG9wOiAxMiwgYm9yZGVyVG9wOiAiMXB4IHNvbGlkICNlNGU0ZTciLCBwYWRkaW5nVG9wOiAxMCB9fT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEgzPlN1bW1hcnk8L0gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8U21hbGw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRWZmZWN0aXZlIGRlZmF1bHRzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsiICJ9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeygoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlZmYgPSBlZmZlY3RpdmVEZWZhdWx0c0ZvclBvc2l0aW9uKHNlbGVjdGVkRXN0aW1hdGUsIHBvc0RyYWZ0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgJHtlZmYuc3VwcGxpZXIgfHwgIuKAlCJ9IC8gJHtlZmYucHJvZHVjdFR5cGUgfHwgIuKAlCJ9IC8gJHtlZmYucHJvZHVjdCB8fCAi4oCUIn0g4oCiIEhpbmdlOiAke2VmZi5oaW5nZVR5cGV9IOKAoiBHbGFzczogJHtlZmYuZ2xhc3NUeXBlfSBVZyAke2VmZi51Z1ZhbHVlfSBHICR7ZWZmLmdWYWx1ZX1gOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKCl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvU21hbGw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IG1hcmdpblRvcDogMTIsIGRpc3BsYXk6ICJmbGV4IiwgYWxpZ25JdGVtczogImNlbnRlciIsIGp1c3RpZnlDb250ZW50OiAic3BhY2UtYmV0d2VlbiIgfX0+CiAgICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIHZhcmlhbnQ9InNlY29uZGFyeSIgb25DbGljaz17KCkgPT4gc2V0UG9zU3RlcCgocykgPT4gKHMgPT09IDEgPyAxIDogKChzIC0gMSkgYXMgYW55KSkpfSBkaXNhYmxlZD17cG9zU3RlcCA9PT0gMX0+CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2sKICAgICAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPgoKICAgICAgICAgICAgICAgICAgICAgIHtwb3NTdGVwIDwgMyA/ICgKICAgICAgICAgICAgICAgICAgICAgICAgPEJ1dHRvbiB2YXJpYW50PSJwcmltYXJ5IiBvbkNsaWNrPXsoKSA9PiBzZXRQb3NTdGVwKChzKSA9PiAoKHMgKyAxKSBhcyBhbnkpKX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgTmV4dAogICAgICAgICAgICAgICAgICAgICAgICA8L0J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICkgOiAoCiAgICAgICAgICAgICAgICAgICAgICAgIDxCdXR0b24gdmFyaWFudD0icHJpbWFyeSIgb25DbGljaz17c2F2ZVBvc2l0aW9uVG9Fc3RpbWF0ZX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgU2F2ZSBQb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICA8L0J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICA8L0NhcmQ+CiAgICAgICAgICAgICl9CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICApOwp9CgoNCg0KDQoNCg==
"@.Trim()

$b64Grid = @"
aW1wb3J0IFJlYWN0LCB7IHVzZUVmZmVjdCwgdXNlTWVtbywgdXNlU3RhdGUgfSBmcm9tICJyZWFjdCI7Cgp0eXBlIFBvc0RyYWZ0ID0gewogIHdpZHRoTW06IG51bWJlcjsKICBoZWlnaHRNbTogbnVtYmVyOwogIGZpZWxkc1g6IG51bWJlcjsKICBmaWVsZHNZOiBudW1iZXI7CiAgaW5zZXJ0aW9uOiBzdHJpbmc7CiAgY2VsbEluc2VydGlvbnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+OyAvLyBrZXk6ICJjb2wscm93IgoKICAvLyBvcHRpb25hbCwgcGVyc2lzdGVkIHBlciBwb3NpdGlvbgogIGNvbFdpZHRoc01tPzogbnVtYmVyW107CiAgcm93SGVpZ2h0c01tPzogbnVtYmVyW107Cn07CgpmdW5jdGlvbiBjbGFtcChuOiBudW1iZXIsIG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcikgewogIHJldHVybiBNYXRoLm1heChtaW4sIE1hdGgubWluKG1heCwgbikpOwp9CgpmdW5jdGlvbiBzdW0oYXJyOiBudW1iZXJbXSkgewogIHJldHVybiBhcnIucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCk7Cn0KCmZ1bmN0aW9uIGV2ZW5TcGxpdCh0b3RhbDogbnVtYmVyLCBwYXJ0czogbnVtYmVyKSB7CiAgY29uc3QgcCA9IGNsYW1wKE1hdGgucm91bmQocGFydHMpLCAxLCAxNik7CiAgY29uc3QgYmFzZSA9IE1hdGguZmxvb3IodG90YWwgLyBwKTsKICBjb25zdCByZW0gPSB0b3RhbCAtIGJhc2UgKiBwOwogIGNvbnN0IG91dDogbnVtYmVyW10gPSBbXTsKICBmb3IgKGxldCBpID0gMDsgaSA8IHA7IGkrKykgb3V0LnB1c2goYmFzZSArIChpIDwgcmVtID8gMSA6IDApKTsKICByZXR1cm4gb3V0Owp9CgpmdW5jdGlvbiBwYXJzZVNsYXNoTGlzdChyYXc6IHN0cmluZykgewogIGNvbnN0IHMgPSAocmF3ID8/ICIiKS50cmltKCk7CiAgaWYgKCFzKSByZXR1cm4gbnVsbDsKICBjb25zdCBpdGVtcyA9IHMuc3BsaXQoIi8iKS5tYXAoKHgpID0+IHgudHJpbSgpKS5maWx0ZXIoQm9vbGVhbik7CiAgaWYgKCFpdGVtcy5sZW5ndGgpIHJldHVybiBudWxsOwogIGNvbnN0IG51bXMgPSBpdGVtcy5tYXAoKHgpID0+IE51bWJlcih4KSk7CiAgaWYgKG51bXMuc29tZSgobikgPT4gIU51bWJlci5pc0Zpbml0ZShuKSB8fCBuIDw9IDApKSByZXR1cm4gbnVsbDsKICByZXR1cm4gbnVtcy5tYXAoKG4pID0+IE1hdGgucm91bmQobikpOwp9CgpmdW5jdGlvbiBmbXRTbGFzaChhcnI6IG51bWJlcltdKSB7CiAgcmV0dXJuIGFyci5tYXAoKG4pID0+IFN0cmluZyhNYXRoLnJvdW5kKG4pKSkuam9pbigiLyIpOwp9CgpmdW5jdGlvbiBsYWJlbEZvckluc2VydGlvbihpbnM6IHN0cmluZykgewogIGNvbnN0IHQgPSAoaW5zIHx8ICIiKS50b0xvd2VyQ2FzZSgpOwogIGlmICh0LmluY2x1ZGVzKCJlbnRyYW5jZSIpKSByZXR1cm4gIkVudHJhbmNlIERvb3IiOwogIGlmICh0LmluY2x1ZGVzKCJsaWZ0IikgfHwgdC5pbmNsdWRlcygic2xpZGUiKSkgcmV0dXJuICJMaWZ0ICYgU2xpZGUiOwogIGlmICh0LmluY2x1ZGVzKCJmcmVuY2giKSkgcmV0dXJuICJGcmVuY2ggRG9vcnMiOwogIGlmICh0LmluY2x1ZGVzKCJzaW5nbGUgZG9vciIpKSByZXR1cm4gIlNpbmdsZSBEb29yIjsKICBpZiAodC5pbmNsdWRlcygiZG9vciIpKSByZXR1cm4gIkRvb3IiOwogIGlmICh0LmluY2x1ZGVzKCJ3aW5kb3ciKSkgcmV0dXJuICJXaW5kb3ciOwogIHJldHVybiBpbnMgfHwgIkluc2VydGlvbiI7Cn0KCmZ1bmN0aW9uIGNlbGxJbmRleDFCYXNlZChjb2w6IG51bWJlciwgcm93OiBudW1iZXIsIGZpZWxkc1g6IG51bWJlcikgewogIHJldHVybiByb3cgKiBmaWVsZHNYICsgY29sICsgMTsKCgpmdW5jdGlvbiBrZXlGb3JDZWxsKGNvbDogbnVtYmVyLCByb3c6IG51bWJlcikgewogIHJldHVybiBgJHtjb2x9LCR7cm93fWA7Cn0KCmZ1bmN0aW9uIG5vcm1hbGl6ZUNlbGxJbnNlcnRpb25zKAogIGZpZWxkc1g6IG51bWJlciwKICBmaWVsZHNZOiBudW1iZXIsCiAgZXhpc3Rpbmc6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gfCB1bmRlZmluZWQsCiAgZmFsbGJhY2s6IHN0cmluZwopIHsKICBjb25zdCBvdXQ6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTsKICBmb3IgKGxldCByID0gMDsgciA8IGZpZWxkc1k7IHIrKykgewogICAgZm9yIChsZXQgYyA9IDA7IGMgPCBmaWVsZHNYOyBjKyspIHsKICAgICAgY29uc3QgayA9IGtleUZvckNlbGwoYywgcik7CiAgICAgIG91dFtrXSA9IGV4aXN0aW5nPy5ba10gPz8gZmFsbGJhY2s7CiAgICB9CiAgfQogIHJldHVybiBvdXQ7Cn0KCmZ1bmN0aW9uIGlzRml4ZWRJbnNlcnRpb24oaW5zOiBzdHJpbmcpIHsKICByZXR1cm4gKGlucyB8fCAiIikudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygiZml4ZWQiKTsKfQoKZnVuY3Rpb24gbWFrZURhc2hQcm9wcyhkYXNoZWQ6IGJvb2xlYW4pIHsKICByZXR1cm4gZGFzaGVkID8geyBzdHJva2VEYXNoYXJyYXk6ICI2IDYiIH0gOiB7fTsKfQoKfQoKZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gR3JpZEVkaXRvcih7CiAgcG9zLAogIHNldFBvcywKICBzZWxlY3RlZENlbGwsCiAgb25TZWxlY3RDZWxsLAogIHZpZXcgPSAiSW5zaWRlIiwKICBvcGVuaW5nU3RkID0gIkRJTiIsCn06IHsKICBwb3M6IFBvc0RyYWZ0OwogIHNldFBvczogUmVhY3QuRGlzcGF0Y2g8UmVhY3QuU2V0U3RhdGVBY3Rpb248YW55Pj47CiAgc2VsZWN0ZWRDZWxsPzogeyBjb2w6IG51bWJlcjsgcm93OiBudW1iZXIgfTsKICBvblNlbGVjdENlbGw/OiAoY2VsbDogeyBjb2w6IG51bWJlcjsgcm93OiBudW1iZXIgfSkgPT4gdm9pZDsKICB2aWV3PzogIkluc2lkZSIgfCAiT3V0c2lkZSI7CiAgb3BlbmluZ1N0ZD86ICJESU4iIHwgIlVLIjsKfSkgewogIGNvbnN0IHRvdGFsVyA9IGNsYW1wKE1hdGgucm91bmQocG9zLndpZHRoTW0gfHwgMCksIDMwMCwgNjAwMCk7CiAgY29uc3QgdG90YWxIID0gY2xhbXAoTWF0aC5yb3VuZChwb3MuaGVpZ2h0TW0gfHwgMCksIDMwMCwgNjAwMCk7CiAgY29uc3QgZnggPSBjbGFtcChNYXRoLnJvdW5kKHBvcy5maWVsZHNYIHx8IDEpLCAxLCAxNik7CiAgY29uc3QgZnkgPSBjbGFtcChNYXRoLnJvdW5kKHBvcy5maWVsZHNZIHx8IDEpLCAxLCAxNik7CgogIC8vIEtlZXAgbG9jYWwgZWRpdCBzdHJpbmdzIGZvciBzbGFzaCBpbnB1dCBVWAogIGNvbnN0IFtjb2xTdHIsIHNldENvbFN0cl0gPSB1c2VTdGF0ZSgiIik7CiAgY29uc3QgW3Jvd1N0ciwgc2V0Um93U3RyXSA9IHVzZVN0YXRlKCIiKTsKICBjb25zdCBbY29sRGlydHksIHNldENvbERpcnR5XSA9IHVzZVN0YXRlKGZhbHNlKTsKICBjb25zdCBbcm93RGlydHksIHNldFJvd0RpcnR5XSA9IHVzZVN0YXRlKGZhbHNlKTsKCiAgLy8gSW5pdGlhbGlzZSAvIHJlcGFpciB3aWR0aHMvaGVpZ2h0cwogIGNvbnN0IGNvbHMgPSB1c2VNZW1vKCgpID0+IHsKICAgIGNvbnN0IGV4aXN0aW5nID0gQXJyYXkuaXNBcnJheShwb3MuY29sV2lkdGhzTW0pID8gcG9zLmNvbFdpZHRoc01tLnNsaWNlKCkgOiBudWxsOwogICAgaWYgKCFleGlzdGluZyB8fCBleGlzdGluZy5sZW5ndGggIT09IGZ4KSByZXR1cm4gZXZlblNwbGl0KHRvdGFsVywgZngpOwogICAgY29uc3QgcyA9IHN1bShleGlzdGluZyk7CiAgICBpZiAocyAhPT0gdG90YWxXKSB7CiAgICAgIC8vIHNjYWxlIHJvdWdobHkgdG8gZml0IHRvdGFsCiAgICAgIGNvbnN0IHNjYWxlZCA9IGV4aXN0aW5nLm1hcCgodikgPT4gTWF0aC5tYXgoMSwgTWF0aC5yb3VuZCgodiAvIHMpICogdG90YWxXKSkpOwogICAgICAvLyBmaXggcm91bmRpbmcgZHJpZnQKICAgICAgbGV0IGRyaWZ0ID0gdG90YWxXIC0gc3VtKHNjYWxlZCk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2NhbGVkLmxlbmd0aCAmJiBkcmlmdCAhPT0gMDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc3RlcCA9IGRyaWZ0ID4gMCA/IDEgOiAtMTsKICAgICAgICBpZiAoc2NhbGVkW2ldICsgc3RlcCA+PSAxKSB7CiAgICAgICAgICBzY2FsZWRbaV0gKz0gc3RlcDsKICAgICAgICAgIGRyaWZ0IC09IHN0ZXA7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBzY2FsZWQ7CiAgICB9CiAgICByZXR1cm4gZXhpc3RpbmcubWFwKCh2KSA9PiBNYXRoLm1heCgxLCBNYXRoLnJvdW5kKHYpKSk7CiAgfSwgW3Bvcy5jb2xXaWR0aHNNbSwgZngsIHRvdGFsV10pOwoKICBjb25zdCByb3dzID0gdXNlTWVtbygoKSA9PiB7CiAgICBjb25zdCBleGlzdGluZyA9IEFycmF5LmlzQXJyYXkocG9zLnJvd0hlaWdodHNNbSkgPyBwb3Mucm93SGVpZ2h0c01tLnNsaWNlKCkgOiBudWxsOwogICAgaWYgKCFleGlzdGluZyB8fCBleGlzdGluZy5sZW5ndGggIT09IGZ5KSByZXR1cm4gZXZlblNwbGl0KHRvdGFsSCwgZnkpOwogICAgY29uc3QgcyA9IHN1bShleGlzdGluZyk7CiAgICBpZiAocyAhPT0gdG90YWxIKSB7CiAgICAgIGNvbnN0IHNjYWxlZCA9IGV4aXN0aW5nLm1hcCgodikgPT4gTWF0aC5tYXgoMSwgTWF0aC5yb3VuZCgodiAvIHMpICogdG90YWxIKSkpOwogICAgICBsZXQgZHJpZnQgPSB0b3RhbEggLSBzdW0oc2NhbGVkKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzY2FsZWQubGVuZ3RoICYmIGRyaWZ0ICE9PSAwOyBpKyspIHsKICAgICAgICBjb25zdCBzdGVwID0gZHJpZnQgPiAwID8gMSA6IC0xOwogICAgICAgIGlmIChzY2FsZWRbaV0gKyBzdGVwID49IDEpIHsKICAgICAgICAgIHNjYWxlZFtpXSArPSBzdGVwOwogICAgICAgICAgZHJpZnQgLT0gc3RlcDsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHNjYWxlZDsKICAgIH0KICAgIHJldHVybiBleGlzdGluZy5tYXAoKHYpID0+IE1hdGgubWF4KDEsIE1hdGgucm91bmQodikpKTsKICB9LCBbcG9zLnJvd0hlaWdodHNNbSwgZnksIHRvdGFsSF0pOwoKICAvLyBLZWVwIHBvc0RyYWZ0IGluIHN5bmMgd2l0aCBjb21wdXRlZCBhcnJheXMgKHN5bW1ldHJ5IGJ5IGRlZmF1bHQpCiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIHNldFBvcygocDogYW55KSA9PiAoewogICAgICAuLi5wLAogICAgICB3aWR0aE1tOiB0b3RhbFcsCiAgICAgIGhlaWdodE1tOiB0b3RhbEgsCiAgICAgIGZpZWxkc1g6IGZ4LAogICAgICBmaWVsZHNZOiBmeSwKICAgICAgY29sV2lkdGhzTW06IGNvbHMsCiAgICAgIHJvd0hlaWdodHNNbTogcm93cywKICAgIH0pKTsKICAgIC8vIGtlZXAgaW5wdXQgc3RyaW5ncyByZWZsZWN0aW5nIGN1cnJlbnQgdmFsdWVzIHVubGVzcyB1c2VyIGlzIGVkaXRpbmcKICAgIHNldENvbFN0cigocykgPT4gKGNvbERpcnR5ID8gcyA6IGZtdFNsYXNoKGNvbHMpKSk7CiAgICBzZXRSb3dTdHIoKHMpID0+IChyb3dEaXJ0eSA/IHMgOiBmbXRTbGFzaChyb3dzKSkpOwogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwcwogIH0sIFt0b3RhbFcsIHRvdGFsSCwgZngsIGZ5XSk7CgogIC8vIEFwcGx5IHNsYXNoIGxpc3Qgb24gYmx1ci9lbnRlcgogIGNvbnN0IGFwcGx5Q29scyA9ICgpID0+IHsKICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlU2xhc2hMaXN0KGNvbFN0cik7CiAgICBpZiAoIXBhcnNlZCkgewogICAgICBzZXRDb2xTdHIoZm10U2xhc2goY29scykpOwogICAgICBzZXRDb2xEaXJ0eShmYWxzZSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChwYXJzZWQubGVuZ3RoICE9PSBmeCkgewogICAgICBzZXRDb2xTdHIoZm10U2xhc2goY29scykpOwogICAgICBzZXRDb2xEaXJ0eShmYWxzZSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChzdW0ocGFyc2VkKSAhPT0gdG90YWxXKSB7CiAgICAgIHNldENvbFN0cihmbXRTbGFzaChjb2xzKSk7CiAgICAgIHNldENvbERpcnR5KGZhbHNlKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgc2V0UG9zKChwOiBhbnkpID0+ICh7IC4uLnAsIGNvbFdpZHRoc01tOiBwYXJzZWQgfSkpOwogICAgc2V0Q29sRGlydHkoZmFsc2UpOwogIH07CgogIGNvbnN0IGFwcGx5Um93cyA9ICgpID0+IHsKICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlU2xhc2hMaXN0KHJvd1N0cik7CiAgICBpZiAoIXBhcnNlZCkgewogICAgICBzZXRSb3dTdHIoZm10U2xhc2gocm93cykpOwogICAgICBzZXRSb3dEaXJ0eShmYWxzZSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChwYXJzZWQubGVuZ3RoICE9PSBmeSkgewogICAgICBzZXRSb3dTdHIoZm10U2xhc2gocm93cykpOwogICAgICBzZXRSb3dEaXJ0eShmYWxzZSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChzdW0ocGFyc2VkKSAhPT0gdG90YWxIKSB7CiAgICAgIHNldFJvd1N0cihmbXRTbGFzaChyb3dzKSk7CiAgICAgIHNldFJvd0RpcnR5KGZhbHNlKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgc2V0UG9zKChwOiBhbnkpID0+ICh7IC4uLnAsIHJvd0hlaWdodHNNbTogcGFyc2VkIH0pKTsKICAgIHNldFJvd0RpcnR5KGZhbHNlKTsKICB9OwoKICAvLyBSZW1vdmUgc3BsaXQgYnkgY2xpY2tpbmcgZGl2aWRlciAtPiBtZXJnZSB0d28gYWRqYWNlbnQgcGFydHMgYW5kIHJlZHVjZSBjb3VudAogIGNvbnN0IHJlbW92ZVZTcGxpdCA9IChzcGxpdEluZGV4OiBudW1iZXIpID0+IHsKICAgIC8vIHNwbGl0SW5kZXggaXMgYm91bmRhcnkgYmV0d2VlbiBjb2xbc3BsaXRJbmRleC0xXSBhbmQgY29sW3NwbGl0SW5kZXhdCiAgICBpZiAoZnggPD0gMSkgcmV0dXJuOwogICAgY29uc3QgaSA9IGNsYW1wKHNwbGl0SW5kZXgsIDEsIGZ4IC0gMSk7CiAgICBjb25zdCBuZXh0ID0gY29scy5zbGljZSgpOwogICAgbmV4dFtpIC0gMV0gPSBuZXh0W2kgLSAxXSArIG5leHRbaV07CiAgICBuZXh0LnNwbGljZShpLCAxKTsKICAgIHNldFBvcygocDogYW55KSA9PiB7CiAgICAgIGNvbnN0IGV4aXN0aW5nID0gbm9ybWFsaXplQ2VsbEluc2VydGlvbnMocC5maWVsZHNYLCBwLmZpZWxkc1ksIHAuY2VsbEluc2VydGlvbnMsIHAuaW5zZXJ0aW9uKTsKICAgICAgY29uc3QgbWVyZ2VkOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307CiAgICAgIGZvciAobGV0IHIgPSAwOyByIDwgcC5maWVsZHNZOyByKyspIHsKICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IHAuZmllbGRzWCAtIDE7IGMrKykgewogICAgICAgICAgLy8gY29sdW1ucyA+PSBpIHNoaWZ0IGxlZnQgYnkgMTsgbWVyZ2VkIGNlbGwgdGFrZXMgbGVmdCBpbnNlcnRpb24KICAgICAgICAgIGNvbnN0IHNyY0MgPSBjIDwgaSA/IGMgOiBjICsgMTsKICAgICAgICAgIGNvbnN0IGsgPSBrZXlGb3JDZWxsKGMsIHIpOwogICAgICAgICAgY29uc3Qgc3JjS2V5ID0ga2V5Rm9yQ2VsbChzcmNDLCByKTsKICAgICAgICAgIG1lcmdlZFtrXSA9IGV4aXN0aW5nW3NyY0tleV07CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB7IC4uLnAsIGZpZWxkc1g6IGZ4IC0gMSwgY29sV2lkdGhzTW06IG5leHQsIGNlbGxJbnNlcnRpb25zOiBtZXJnZWQgfTsKICAgIH0pOwogICAgc2V0Q29sRGlydHkoZmFsc2UpOwogIH07CgogIGNvbnN0IHJlbW92ZUhTcGxpdCA9IChzcGxpdEluZGV4OiBudW1iZXIpID0+IHsKICAgIGlmIChmeSA8PSAxKSByZXR1cm47CiAgICBjb25zdCBpID0gY2xhbXAoc3BsaXRJbmRleCwgMSwgZnkgLSAxKTsKICAgIGNvbnN0IG5leHQgPSByb3dzLnNsaWNlKCk7CiAgICBuZXh0W2kgLSAxXSA9IG5leHRbaSAtIDFdICsgbmV4dFtpXTsKICAgIG5leHQuc3BsaWNlKGksIDEpOwogICAgc2V0UG9zKChwOiBhbnkpID0+IHsKICAgICAgY29uc3QgZXhpc3RpbmcgPSBub3JtYWxpemVDZWxsSW5zZXJ0aW9ucyhwLmZpZWxkc1gsIHAuZmllbGRzWSwgcC5jZWxsSW5zZXJ0aW9ucywgcC5pbnNlcnRpb24pOwogICAgICBjb25zdCBtZXJnZWQ6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTsKICAgICAgZm9yIChsZXQgciA9IDA7IHIgPCBwLmZpZWxkc1kgLSAxOyByKyspIHsKICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IHAuZmllbGRzWDsgYysrKSB7CiAgICAgICAgICBjb25zdCBzcmNSID0gciA8IGkgPyByIDogciArIDE7CiAgICAgICAgICBjb25zdCBrID0ga2V5Rm9yQ2VsbChjLCByKTsKICAgICAgICAgIGNvbnN0IHNyY0tleSA9IGtleUZvckNlbGwoYywgc3JjUik7CiAgICAgICAgICBtZXJnZWRba10gPSBleGlzdGluZ1tzcmNLZXldOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4geyAuLi5wLCBmaWVsZHNZOiBmeSAtIDEsIHJvd0hlaWdodHNNbTogbmV4dCwgY2VsbEluc2VydGlvbnM6IG1lcmdlZCB9OwogICAgfSk7CiAgICBzZXRSb3dEaXJ0eShmYWxzZSk7CiAgfTsKCiAgLy8gLS0tIExvZ2lLYWwtc3R5bGUgdGVjaG5pY2FsIHByZXZpZXcgZ2VvbWV0cnkgLS0tCiAgY29uc3QgdmJXID0gNTIwOwogIGNvbnN0IHZiSCA9IDUyMDsKCiAgY29uc3QgcGFkID0gNTY7IC8vIG91dGVyIHBhZGRpbmcgYXJvdW5kIGRyYXdpbmcgKyBkaW1lbnNpb24gc3BhY2UKICBjb25zdCBhdmFpbFcgPSB2YlcgLSBwYWQgKiAyOwogIGNvbnN0IGF2YWlsSCA9IHZiSCAtIHBhZCAqIDI7CgogIGNvbnN0IHJhdGlvID0gTWF0aC5tYXgoMC4xLCB0b3RhbFcgLyBNYXRoLm1heCgxLCB0b3RhbEgpKTsKICBsZXQgZnJhbWVXID0gYXZhaWxXOwogIGxldCBmcmFtZUggPSBmcmFtZVcgLyByYXRpbzsKICBpZiAoZnJhbWVIID4gYXZhaWxIKSB7CiAgICBmcmFtZUggPSBhdmFpbEg7CiAgICBmcmFtZVcgPSBmcmFtZUggKiByYXRpbzsKICB9CgogIGNvbnN0IGZyYW1lWCA9IHBhZCArIChhdmFpbFcgLSBmcmFtZVcpIC8gMjsKICBjb25zdCBmcmFtZVkgPSBwYWQgKyAoYXZhaWxIIC0gZnJhbWVIKSAvIDI7CgogIGNvbnN0IGZyYW1lVGggPSAxODsKCi8vIExvZ2lLYWwtbGlrZTogZnJhbWUgLT4gZ2FwIC0+IHNhc2ggcHJvZmlsZSAtPiBnbGFzcyBhcmVhCmNvbnN0IHNhc2hHYXAgPSA2Owpjb25zdCBzYXNoT3V0ZXJYID0gZnJhbWVYICsgZnJhbWVUaCArIHNhc2hHYXA7CmNvbnN0IHNhc2hPdXRlclkgPSBmcmFtZVkgKyBmcmFtZVRoICsgc2FzaEdhcDsKY29uc3Qgc2FzaE91dGVyVyA9IGZyYW1lVyAtIChmcmFtZVRoICsgc2FzaEdhcCkgKiAyOwpjb25zdCBzYXNoT3V0ZXJIID0gZnJhbWVIIC0gKGZyYW1lVGggKyBzYXNoR2FwKSAqIDI7Cgpjb25zdCBzYXNoUHJvZmlsZSA9IDE2Owpjb25zdCBnbGFzc1ggPSBzYXNoT3V0ZXJYICsgc2FzaFByb2ZpbGU7CmNvbnN0IGdsYXNzWSA9IHNhc2hPdXRlclkgKyBzYXNoUHJvZmlsZTsKY29uc3QgZ2xhc3NXID0gc2FzaE91dGVyVyAtIHNhc2hQcm9maWxlICogMjsKY29uc3QgZ2xhc3NIID0gc2FzaE91dGVySCAtIHNhc2hQcm9maWxlICogMjsKCiAgY29uc3QgeFN0b3BzID0gdXNlTWVtbygoKSA9PiB7CiAgICBjb25zdCB4czogbnVtYmVyW10gPSBbZ2xhc3NYXTsKICAgIGxldCBhY2MgPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGFjYyArPSBjb2xzW2ldIC8gdG90YWxXOwogICAgICB4cy5wdXNoKGdsYXNzWCArIGdsYXNzVyAqIGFjYyk7CiAgICB9CiAgICB4c1t4cy5sZW5ndGggLSAxXSA9IGdsYXNzWCArIGdsYXNzVzsKICAgIHJldHVybiB4czsKICB9LCBbY29scywgdG90YWxXLCBnbGFzc1gsIGdsYXNzV10pOwoKICBjb25zdCB5U3RvcHMgPSB1c2VNZW1vKCgpID0+IHsKICAgIGNvbnN0IHlzOiBudW1iZXJbXSA9IFtnbGFzc1ldOwogICAgbGV0IGFjYyA9IDA7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJvd3MubGVuZ3RoOyBpKyspIHsKICAgICAgYWNjICs9IHJvd3NbaV0gLyB0b3RhbEg7CiAgICAgIHlzLnB1c2goZ2xhc3NZICsgZ2xhc3NIICogYWNjKTsKICAgIH0KICAgIHlzW3lzLmxlbmd0aCAtIDFdID0gZ2xhc3NZICsgZ2xhc3NIOwogICAgcmV0dXJuIHlzOwogIH0sIFtyb3dzLCB0b3RhbEgsIGdsYXNzWSwgZ2xhc3NIXSk7CgogIHJldHVybiAoCiAgICA8ZGl2IHN0eWxlPXt7IGRpc3BsYXk6ICJncmlkIiwgZ2FwOiAxMCB9fT4KICAgICAgPGRpdiBzdHlsZT17eyBib3JkZXJSYWRpdXM6IDE2LCBib3JkZXI6ICIxcHggc29saWQgI2U0ZTRlNyIsIGJhY2tncm91bmQ6ICIjZmZmIiwgcGFkZGluZzogMTAgfX0+CiAgICAgICAgPGRpdiBzdHlsZT17eyBmb250U2l6ZTogMTIsIGNvbG9yOiAiIzcxNzE3YSIsIG1hcmdpbkJvdHRvbTogOCB9fT4KICAgICAgICAgIHtsYWJlbEZvckluc2VydGlvbihwb3MuaW5zZXJ0aW9uKX0g4oCiIHtmeH3Dl3tmeX0g4oCiIHt0b3RhbFd9w5d7dG90YWxIfSBtbQogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IHN0eWxlPXt7IHdpZHRoOiAiMTAwJSIsIGFzcGVjdFJhdGlvOiAiMTYvOSIgfX0+CiAgICAgICAgICA8c3ZnIHZpZXdCb3g9e2AwIDAgJHt2Yld9ICR7dmJIfWB9IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHN0eWxlPXt7IGRpc3BsYXk6ICJibG9jayIgfX0+CiAgICAgICAgICAgIDxyZWN0IHg9ezB9IHk9ezB9IHdpZHRoPXt2Yld9IGhlaWdodD17dmJIfSBmaWxsPSIjZmZmZmZmIiAvPgoKICAgICAgICAgICAgey8qIEZyYW1lICh0ZWNobmljYWwsIHNxdWFyZSBjb3JuZXJzKSAqL30KICAgICAgICAgICAgPHJlY3QgeD17ZnJhbWVYfSB5PXtmcmFtZVl9IHdpZHRoPXtmcmFtZVd9IGhlaWdodD17ZnJhbWVIfSBmaWxsPSJub25lIiBzdHJva2U9IiMxMTEiIHN0cm9rZVdpZHRoPXsxLjZ9IC8+CiAgICAgICAgICAgIDxyZWN0CiAgICAgICAgICAgICAgeD17ZnJhbWVYICsgZnJhbWVUaH0KICAgICAgICAgICAgICB5PXtmcmFtZVkgKyBmcmFtZVRofQogICAgICAgICAgICAgIHdpZHRoPXtmcmFtZVcgLSBmcmFtZVRoICogMn0KICAgICAgICAgICAgICBoZWlnaHQ9e2ZyYW1lSCAtIGZyYW1lVGggKiAyfQogICAgICAgICAgICAgIGZpbGw9Im5vbmUiCiAgICAgICAgICAgICAgc3Ryb2tlPSIjMTExIgogICAgICAgICAgICAgIHN0cm9rZVdpZHRoPXsxfQogICAgICAgICAgICAvPgoKICAgICAgICAgICAgey8qIFNhc2ggKHByb2ZpbGUpICsgR2xhc3MgKExvZ2lLYWwtbGlrZSkgKi99CiAgICAgICAgICAgIHshYWxsRml4ZWQgJiYgdmlldyA9PT0gIkluc2lkZSIgPyAoCiAgICAgICAgICAgICAgPHJlY3QgeD17c2FzaE91dGVyWH0geT17c2FzaE91dGVyWX0gd2lkdGg9e3Nhc2hPdXRlcld9IGhlaWdodD17c2FzaE91dGVySH0gZmlsbD0iI2U2ZTllZSIgc3Ryb2tlPSIjMTExIiBzdHJva2VXaWR0aD17MS4yfSAvPgogICAgICAgICAgICApIDogbnVsbH0KICAgICAgICAgICAgPHJlY3QgeD17Z2xhc3NYfSB5PXtnbGFzc1l9IHdpZHRoPXtnbGFzc1d9IGhlaWdodD17Z2xhc3NIfSBmaWxsPSIjYjlkN2YzIiBzdHJva2U9IiMxMTEiIHN0cm9rZVdpZHRoPXsxfSAvPgoKICAgICAgICAgICAgey8qIEdyaWQgbGluZXMgKi99CiAgICAgICAgICAgIHt4U3RvcHMuc2xpY2UoMSwgLTEpLm1hcCgoeCwgaWR4KSA9PiAoCiAgICAgICAgICAgICAgPGcga2V5PXsidiIgKyBpZHh9PgogICAgICAgICAgICAgICAgPGxpbmUgeDE9e3h9IHkxPXtnbGFzc1l9IHgyPXt4fSB5Mj17Z2xhc3NZICsgZ2xhc3NIfSBzdHJva2U9IiMxMTEiIHN0cm9rZVdpZHRoPXsxfSAvPgogICAgICAgICAgICAgICAgey8qIGNsaWNrYWJsZSB6b25lICovfQogICAgICAgICAgICAgICAgPGxpbmUKICAgICAgICAgICAgICAgICAgeDE9e3h9CiAgICAgICAgICAgICAgICAgIHkxPXtnbGFzc1l9CiAgICAgICAgICAgICAgICAgIHgyPXt4fQogICAgICAgICAgICAgICAgICB5Mj17Z2xhc3NZICsgZ2xhc3NIfQogICAgICAgICAgICAgICAgICBzdHJva2U9InRyYW5zcGFyZW50IgogICAgICAgICAgICAgICAgICBzdHJva2VXaWR0aD17MTZ9CiAgICAgICAgICAgICAgICAgIHN0eWxlPXt7IGN1cnNvcjogInBvaW50ZXIiIH19CiAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHJlbW92ZVZTcGxpdChpZHggKyAxKX0KICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICApKX0KCiAgICAgICAgICAgIHt5U3RvcHMuc2xpY2UoMSwgLTEpLm1hcCgoeSwgaWR4KSA9PiAoCiAgICAgICAgICAgICAgPGcga2V5PXsiaCIgKyBpZHh9PgogICAgICAgICAgICAgICAgPGxpbmUgeDE9e2dsYXNzWH0geTE9e3l9IHgyPXtnbGFzc1ggKyBnbGFzc1d9IHkyPXt5fSBzdHJva2U9IiMxMTEiIHN0cm9rZVdpZHRoPXsxfSAvPgogICAgICAgICAgICAgICAgPGxpbmUKICAgICAgICAgICAgICAgICAgeDE9e2dsYXNzWH0KICAgICAgICAgICAgICAgICAgeTE9e3l9CiAgICAgICAgICAgICAgICAgIHgyPXtnbGFzc1ggKyBnbGFzc1d9CiAgICAgICAgICAgICAgICAgIHkyPXt5fQogICAgICAgICAgICAgICAgICBzdHJva2U9InRyYW5zcGFyZW50IgogICAgICAgICAgICAgICAgICBzdHJva2VXaWR0aD17MTZ9CiAgICAgICAgICAgICAgICAgIHN0eWxlPXt7IGN1cnNvcjogInBvaW50ZXIiIH19CiAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHJlbW92ZUhTcGxpdChpZHggKyAxKX0KICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICApKX0KCiAgICAgICAgICAgIHsvKiBDZWxsIG51bWJlcnMgKExvZ2lLYWwtbGlrZSBmaWVsZCBsYWJlbHMpICovfQogICAgICAgICAgICB7QXJyYXkuZnJvbSh7IGxlbmd0aDogZnkgfSwgKF8sIHJvdykgPT4KICAgICAgICAgICAgICBBcnJheS5mcm9tKHsgbGVuZ3RoOiBmeCB9LCAoXywgY29sKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB4MCA9IHhTdG9wc1tjb2xdOwogICAgICAgICAgICAgICAgY29uc3QgeDEgPSB4U3RvcHNbY29sICsgMV07CiAgICAgICAgICAgICAgICBjb25zdCB5MCA9IHlTdG9wc1tyb3ddOwogICAgICAgICAgICAgICAgY29uc3QgeTEgPSB5U3RvcHNbcm93ICsgMV07CiAgICAgICAgICAgICAgICBjb25zdCBuID0gY2VsbEluZGV4MUJhc2VkKGNvbCwgcm93LCBmeCk7CgogICAgICAgICAgICAgICAgLy8gQ2VudGVyZWQgaGV4IGxhYmVsIChtYXRjaGVzIExvZ2lLYWwtbGlrZSBzY2hlZHVsZSBsYWJlbHMpCiAgICAgICAgICAgICAgICBjb25zdCBjeCA9ICh4MCArIHgxKSAvIDI7CiAgICAgICAgICAgICAgICBjb25zdCBjeSA9ICh5MCArIHkxKSAvIDI7CiAgICAgICAgICAgICAgICBjb25zdCByID0gMTY7IC8vIHJhZGl1cwogICAgICAgICAgICAgICAgY29uc3QgcHRzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogNiB9LCAoXywgaSkgPT4gewogICAgICAgICAgICAgICAgICBjb25zdCBhID0gKE1hdGguUEkgLyAzKSAqIGkgLSBNYXRoLlBJIC8gNjsgLy8gZmxhdC10b3AKICAgICAgICAgICAgICAgICAgcmV0dXJuIGAke2N4ICsgciAqIE1hdGguY29zKGEpfSwke2N5ICsgciAqIE1hdGguc2luKGEpfWA7CiAgICAgICAgICAgICAgICB9KS5qb2luKCIgIik7CgogICAgICAgICAgICAgICAgY29uc3Qga2V5ID0ga2V5Rm9yQ2VsbChjb2wsIHJvdyk7CiAgICAgICAgICAgICAgICBjb25zdCBpbnMgPSBjZWxsSW5zZXJ0aW9uc1trZXldID8/IHBvcy5pbnNlcnRpb247CiAgICAgICAgICAgICAgICBjb25zdCBpc1NlbCA9IHNlbGVjdGVkQ2VsbCAmJiBzZWxlY3RlZENlbGwuY29sID09PSBjb2wgJiYgc2VsZWN0ZWRDZWxsLnJvdyA9PT0gcm93OwoKICAgICAgICAgICAgICAgIC8vIGNvbnZlbnRpb24vdmlldzogd2Uga2VlcCBhIHNpbmdsZSBoYW5kZWRuZXNzIG1vZGVsIGZvciBub3cgKGhhbmRsZSBzaWRlIGRlcml2ZWQgZnJvbSBzdGQgKyB2aWV3KQogICAgICAgICAgICAgICAgY29uc3Qgc3dhcCA9ICh2aWV3ID09PSAiT3V0c2lkZSIpICE9PSAob3BlbmluZ1N0ZCA9PT0gIlVLIik7CiAgICAgICAgICAgICAgICBjb25zdCBoaW5nZUxlZnQgPSAhc3dhcDsgLy8gRElOK0luc2lkZSA9PiBoaW5nZSBsZWZ0OyBmbGlwcGVkIG90aGVyd2lzZQogICAgICAgICAgICAgICAgY29uc3QgaHggPSBoaW5nZUxlZnQgPyB4MCA6IHgxOwogICAgICAgICAgICAgICAgY29uc3Qgb3ggPSBoaW5nZUxlZnQgPyB4MSA6IHgwOwoKICAgICAgICAgICAgICAgIGNvbnN0IGRhc2ggPSB7IHN0cm9rZTogIiMxMTEiLCBzdHJva2VXaWR0aDogMS4xLCAuLi5tYWtlRGFzaFByb3BzKHRydWUpIH07CiAgICAgICAgICAgICAgICBjb25zdCBzb2xpZCA9IHsgc3Ryb2tlOiAiIzExMSIsIHN0cm9rZVdpZHRoOiAxLjEgfTsKCiAgICAgICAgICAgICAgICBjb25zdCBkcmF3VHVybiA9ICgpID0+ICgKICAgICAgICAgICAgICAgICAgPD4KICAgICAgICAgICAgICAgICAgICA8bGluZSB4MT17aHh9IHkxPXt5MH0geDI9e294fSB5Mj17Y3l9IHsuLi5kYXNofSAvPgogICAgICAgICAgICAgICAgICAgIDxsaW5lIHgxPXtoeH0geTE9e3kxfSB4Mj17b3h9IHkyPXtjeX0gey4uLmRhc2h9IC8+CiAgICAgICAgICAgICAgICAgIDwvPgogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBjb25zdCBkcmF3VGlsdCA9ICgpID0+ICgKICAgICAgICAgICAgICAgICAgPD4KICAgICAgICAgICAgICAgICAgICA8bGluZSB4MT17eDB9IHkxPXt5MX0geDI9e2N4fSB5Mj17eTB9IHsuLi5kYXNofSAvPgogICAgICAgICAgICAgICAgICAgIDxsaW5lIHgxPXt4MX0geTE9e3kxfSB4Mj17Y3h9IHkyPXt5MH0gey4uLmRhc2h9IC8+CiAgICAgICAgICAgICAgICAgIDwvPgogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBjb25zdCBkcmF3VG9wSHVuZyA9ICgpID0+ICgKICAgICAgICAgICAgICAgICAgPD4KICAgICAgICAgICAgICAgICAgICA8bGluZSB4MT17eDB9IHkxPXt5MH0geDI9e2N4fSB5Mj17eTF9IHsuLi5kYXNofSAvPgogICAgICAgICAgICAgICAgICAgIDxsaW5lIHgxPXt4MX0geTE9e3kwfSB4Mj17Y3h9IHkyPXt5MX0gey4uLmRhc2h9IC8+CiAgICAgICAgICAgICAgICAgIDwvPgogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBjb25zdCBkcmF3UmV2ZXJzaWJsZSA9ICgpID0+ICgKICAgICAgICAgICAgICAgICAgPD4KICAgICAgICAgICAgICAgICAgICA8bGluZSB4MT17Y3h9IHkxPXt5MH0geDI9e3gwfSB5Mj17Y3l9IHsuLi5kYXNofSAvPgogICAgICAgICAgICAgICAgICAgIDxsaW5lIHgxPXtjeH0geTE9e3kwfSB4Mj17eDF9IHkyPXtjeX0gey4uLmRhc2h9IC8+CiAgICAgICAgICAgICAgICAgICAgPGxpbmUgeDE9e2N4fSB5MT17eTF9IHgyPXt4MH0geTI9e2N5fSB7Li4uZGFzaH0gLz4KICAgICAgICAgICAgICAgICAgICA8bGluZSB4MT17Y3h9IHkxPXt5MX0geDI9e3gxfSB5Mj17Y3l9IHsuLi5kYXNofSAvPgogICAgICAgICAgICAgICAgICA8Lz4KICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgY29uc3QgZHJhd0ZpeGVkID0gKCkgPT4gKAogICAgICAgICAgICAgICAgICA8PgogICAgICAgICAgICAgICAgICAgIDxsaW5lIHgxPXtjeCAtICh4MSAtIHgwKSAqIDAuMTh9IHkxPXtjeX0geDI9e2N4ICsgKHgxIC0geDApICogMC4xOH0geTI9e2N5fSB7Li4uc29saWR9IC8+CiAgICAgICAgICAgICAgICAgICAgPGxpbmUgeDE9e2N4fSB5MT17Y3kgLSAoeTEgLSB5MCkgKiAwLjE4fSB4Mj17Y3h9IHkyPXtjeSArICh5MSAtIHkwKSAqIDAuMTh9IHsuLi5zb2xpZH0gLz4KICAgICAgICAgICAgICAgICAgPC8+CiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIGNvbnN0IGRyYXdTeW1ib2wgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSAoaW5zIHx8ICIiKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICBpZiAodC5pbmNsdWRlcygidGlsdCIpICYmIHQuaW5jbHVkZXMoInR1cm4iKSkgcmV0dXJuICg8PntkcmF3VHVybigpfXtkcmF3VGlsdCgpfTwvPik7CiAgICAgICAgICAgICAgICAgIGlmICh0LmluY2x1ZGVzKCJ0b3AgaHVuZyIpKSByZXR1cm4gZHJhd1RvcEh1bmcoKTsKICAgICAgICAgICAgICAgICAgaWYgKHQuaW5jbHVkZXMoInRpbHQiKSkgcmV0dXJuIGRyYXdUaWx0KCk7CiAgICAgICAgICAgICAgICAgIGlmICh0LmluY2x1ZGVzKCJyZXZlcnNpYmxlIikpIHJldHVybiBkcmF3UmV2ZXJzaWJsZSgpOwogICAgICAgICAgICAgICAgICBpZiAodC5pbmNsdWRlcygic2lkZSBodW5nIikgfHwgdC5pbmNsdWRlcygidHVybiIpKSByZXR1cm4gZHJhd1R1cm4oKTsKICAgICAgICAgICAgICAgICAgaWYgKHQuaW5jbHVkZXMoImZpeGVkIikpIHJldHVybiBkcmF3Rml4ZWQoKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgIDxnIGtleT17YGMtJHtjb2x9LSR7cm93fWB9PgogICAgICAgICAgICAgICAgICAgIHsvKiBjbGljayB0YXJnZXQgKi99CiAgICAgICAgICAgICAgICAgICAgPHJlY3QKICAgICAgICAgICAgICAgICAgICAgIHg9e3gwfQogICAgICAgICAgICAgICAgICAgICAgeT17eTB9CiAgICAgICAgICAgICAgICAgICAgICB3aWR0aD17eDEgLSB4MH0KICAgICAgICAgICAgICAgICAgICAgIGhlaWdodD17eTEgLSB5MH0KICAgICAgICAgICAgICAgICAgICAgIGZpbGw9InRyYW5zcGFyZW50IgogICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3sgY3Vyc29yOiBvblNlbGVjdENlbGwgPyAicG9pbnRlciIgOiAiZGVmYXVsdCIgfX0KICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IG9uU2VsZWN0Q2VsbD8uKHsgY29sLCByb3cgfSl9CiAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICB7Lyogc2VsZWN0aW9uIGhpZ2hsaWdodCAqL30KICAgICAgICAgICAgICAgICAgICB7aXNTZWwgPyAoCiAgICAgICAgICAgICAgICAgICAgICA8cmVjdCB4PXt4MH0geT17eTB9IHdpZHRoPXt4MSAtIHgwfSBoZWlnaHQ9e3kxIC0geTB9IGZpbGw9Im5vbmUiIHN0cm9rZT0iIzIyYzU1ZSIgc3Ryb2tlV2lkdGg9ezJ9IC8+CiAgICAgICAgICAgICAgICAgICAgKSA6IG51bGx9CgogICAgICAgICAgICAgICAgICAgIHsvKiBvcGVyYXRpb24gc3ltYm9sIChjbG9zZWQpICovfQogICAgICAgICAgICAgICAgICAgIHtkcmF3U3ltYm9sKCl9CgogICAgICAgICAgICAgICAgICAgIHsvKiBoZXggZmllbGQgbGFiZWwgKi99CiAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gcG9pbnRzPXtwdHN9IGZpbGw9IiNmZmYiIHN0cm9rZT0iIzExMSIgc3Ryb2tlV2lkdGg9ezF9IC8+CiAgICAgICAgICAgICAgICAgICAgPHRleHQKICAgICAgICAgICAgICAgICAgICAgIHg9e2N4fQogICAgICAgICAgICAgICAgICAgICAgeT17Y3kgKyA0fQogICAgICAgICAgICAgICAgICAgICAgdGV4dEFuY2hvcj0ibWlkZGxlIgogICAgICAgICAgICAgICAgICAgICAgZm9udFNpemU9ezE0fQogICAgICAgICAgICAgICAgICAgICAgZm9udFdlaWdodD17NjAwfQogICAgICAgICAgICAgICAgICAgICAgZmlsbD0iIzExMSIKICAgICAgICAgICAgICAgICAgICAgIGZvbnRGYW1pbHk9InVpLXNhbnMtc2VyaWYsIHN5c3RlbS11aSwgLWFwcGxlLXN5c3RlbSIKICAgICAgICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICAgICAgICB7bn0KICAgICAgICAgICAgICAgICAgICA8L3RleHQ+CiAgICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgKX0Key8qIERpbWVuc2lvbnMgKHNpbXBsZSB0ZWNobmljYWwpICovfQogICAgICAgICAgICA8ZyBzdHJva2U9IiMxMTEiIHN0cm9rZVdpZHRoPXswLjl9IGZpbGw9Im5vbmUiIGZvbnRGYW1pbHk9InVpLXNhbnMtc2VyaWYsIHN5c3RlbS11aSwgLWFwcGxlLXN5c3RlbSIgZm9udFNpemU9ezEyfT4KICAgICAgICAgICAgICB7Lyogd2lkdGggbGluZSBiZWxvdyAqL30KICAgICAgICAgICAgICA8bGluZSB4MT17ZnJhbWVYfSB5MT17ZnJhbWVZICsgZnJhbWVIICsgMjZ9IHgyPXtmcmFtZVggKyBmcmFtZVd9IHkyPXtmcmFtZVkgKyBmcmFtZUggKyAyNn0gLz4KICAgICAgICAgICAgICA8bGluZSB4MT17ZnJhbWVYfSB5MT17ZnJhbWVZICsgZnJhbWVIICsgMjB9IHgyPXtmcmFtZVh9IHkyPXtmcmFtZVkgKyBmcmFtZUggKyAzMn0gLz4KICAgICAgICAgICAgICA8bGluZSB4MT17ZnJhbWVYICsgZnJhbWVXfSB5MT17ZnJhbWVZICsgZnJhbWVIICsgMjB9IHgyPXtmcmFtZVggKyBmcmFtZVd9IHkyPXtmcmFtZVkgKyBmcmFtZUggKyAzMn0gLz4KICAgICAgICAgICAgICA8dGV4dCB4PXtmcmFtZVggKyBmcmFtZVcgLyAyfSB5PXtmcmFtZVkgKyBmcmFtZUggKyA0Nn0gdGV4dEFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjMTExIj4KICAgICAgICAgICAgICAgIHt0b3RhbFd9CiAgICAgICAgICAgICAgPC90ZXh0PgoKICAgICAgICAgICAgICB7LyogaGVpZ2h0IGxpbmUgdG8gcmlnaHQgKi99CiAgICAgICAgICAgICAgPGxpbmUgeDE9e2ZyYW1lWCArIGZyYW1lVyArIDI2fSB5MT17ZnJhbWVZfSB4Mj17ZnJhbWVYICsgZnJhbWVXICsgMjZ9IHkyPXtmcmFtZVkgKyBmcmFtZUh9IC8+CiAgICAgICAgICAgICAgPGxpbmUgeDE9e2ZyYW1lWCArIGZyYW1lVyArIDIwfSB5MT17ZnJhbWVZfSB4Mj17ZnJhbWVYICsgZnJhbWVXICsgMzJ9IHkyPXtmcmFtZVl9IC8+CiAgICAgICAgICAgICAgPGxpbmUgeDE9e2ZyYW1lWCArIGZyYW1lVyArIDIwfSB5MT17ZnJhbWVZICsgZnJhbWVIfSB4Mj17ZnJhbWVYICsgZnJhbWVXICsgMzJ9IHkyPXtmcmFtZVkgKyBmcmFtZUh9IC8+CiAgICAgICAgICAgICAgPHRleHQKICAgICAgICAgICAgICAgIHg9e2ZyYW1lWCArIGZyYW1lVyArIDQ2fQogICAgICAgICAgICAgICAgeT17ZnJhbWVZICsgZnJhbWVIIC8gMn0KICAgICAgICAgICAgICAgIHRyYW5zZm9ybT17YHJvdGF0ZSg5MCAke2ZyYW1lWCArIGZyYW1lVyArIDQ2fSAke2ZyYW1lWSArIGZyYW1lSCAvIDJ9KWB9CiAgICAgICAgICAgICAgICB0ZXh0QW5jaG9yPSJtaWRkbGUiCiAgICAgICAgICAgICAgICBmaWxsPSIjMTExIgogICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgIHt0b3RhbEh9CiAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L2c+CgogICAgICAgICAgICB7LyogSGFuZGxlIG1hcmtlciAobmV1dHJhbCwgdGVjaG5pY2FsKSAqL30KICAgICAgICAgICAgPGcgc3Ryb2tlPSIjMTExIiBzdHJva2VXaWR0aD17MS42fSBzdHJva2VMaW5lY2FwPSJyb3VuZCI+CiAgICAgICAgICAgICAgPGxpbmUgeDE9e2ZyYW1lWCArIGZyYW1lVyArIDJ9IHkxPXtmcmFtZVkgKyBmcmFtZUggLyAyIC0gMTB9IHgyPXtmcmFtZVggKyBmcmFtZVcgKyAyfSB5Mj17ZnJhbWVZICsgZnJhbWVIIC8gMiArIDEwfSAvPgogICAgICAgICAgICA8L2c+CiAgICAgICAgICA8L3N2Zz4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgey8qIHNpemluZyBvdmVycmlkZXMgKi99CiAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6IDEwLCBkaXNwbGF5OiAiZ3JpZCIsIGdhcDogMTAgfX0+CiAgICAgICAgICB7ZnggPiAxICYmICgKICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGZvbnRTaXplOiAxMiwgZm9udFdlaWdodDogNzAwLCBtYXJnaW5Cb3R0b206IDYgfX0+CiAgICAgICAgICAgICAgICBDb2x1bW4gd2lkdGhzIChtbSkg4oCUIGZvcm1hdDogMTAwMC81MDAgKG11c3Qgc3VtIHRvIHt0b3RhbFd9KQogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDxpbnB1dAogICAgICAgICAgICAgICAgdmFsdWU9e2NvbFN0cn0KICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gewogICAgICAgICAgICAgICAgICBzZXRDb2xTdHIoZS50YXJnZXQudmFsdWUpOwogICAgICAgICAgICAgICAgICBzZXRDb2xEaXJ0eSh0cnVlKTsKICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgICBvbkJsdXI9e2FwcGx5Q29sc30KICAgICAgICAgICAgICAgIG9uS2V5RG93bj17KGUpID0+IHsKICAgICAgICAgICAgICAgICAgaWYgKGUua2V5ID09PSAiRW50ZXIiKSBhcHBseUNvbHMoKTsKICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgICBzdHlsZT17ewogICAgICAgICAgICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgICAgICAgICAgICBwYWRkaW5nOiAiMTBweCAxMnB4IiwKICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAxMiwKICAgICAgICAgICAgICAgICAgYm9yZGVyOiAiMXB4IHNvbGlkICNlNGU0ZTciLAogICAgICAgICAgICAgICAgICBvdXRsaW5lOiAibm9uZSIsCiAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiAxNCwKICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICApfQoKICAgICAgICAgIHtmeSA+IDEgJiYgKAogICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZm9udFNpemU6IDEyLCBmb250V2VpZ2h0OiA3MDAsIG1hcmdpbkJvdHRvbTogNiB9fT4KICAgICAgICAgICAgICAgIFJvdyBoZWlnaHRzIChtbSkg4oCUIGZvcm1hdDogMTIwMC85MDAgKG11c3Qgc3VtIHRvIHt0b3RhbEh9KQogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDxpbnB1dAogICAgICAgICAgICAgICAgdmFsdWU9e3Jvd1N0cn0KICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gewogICAgICAgICAgICAgICAgICBzZXRSb3dTdHIoZS50YXJnZXQudmFsdWUpOwogICAgICAgICAgICAgICAgICBzZXRSb3dEaXJ0eSh0cnVlKTsKICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgICBvbkJsdXI9e2FwcGx5Um93c30KICAgICAgICAgICAgICAgIG9uS2V5RG93bj17KGUpID0+IHsKICAgICAgICAgICAgICAgICAgaWYgKGUua2V5ID09PSAiRW50ZXIiKSBhcHBseVJvd3MoKTsKICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgICBzdHlsZT17ewogICAgICAgICAgICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgICAgICAgICAgICBwYWRkaW5nOiAiMTBweCAxMnB4IiwKICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAxMiwKICAgICAgICAgICAgICAgICAgYm9yZGVyOiAiMXB4IHNvbGlkICNlNGU0ZTciLAogICAgICAgICAgICAgICAgICBvdXRsaW5lOiAibm9uZSIsCiAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiAxNCwKICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICApfQoKICAgICAgICAgIDxkaXYgc3R5bGU9e3sgZm9udFNpemU6IDEyLCBjb2xvcjogIiM3MTcxN2EiIH19PgogICAgICAgICAgICBUaXA6IGNsaWNrIGEgdmVydGljYWwgb3IgaG9yaXpvbnRhbCBzcGxpdCBsaW5lIGluIHRoZSBkcmF3aW5nIHRvIHJlbW92ZSB0aGF0IHNwbGl0IChlLmcuIDLDlzIg4oaSIHJlbW92ZSBvbmUgc3BsaXQg4oaSIDMgc2VjdGlvbnMpLgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgKTsKfQoKCg0K
"@.Trim()

$b64Main = @"
aW1wb3J0IHsgU3RyaWN0TW9kZSB9IGZyb20gJ3JlYWN0Jw0KaW1wb3J0IHsgY3JlYXRlUm9vdCB9IGZyb20gJ3JlYWN0LWRvbS9jbGllbnQnDQppbXBvcnQgJy4vaW5kZXguY3NzJw0KaW1wb3J0IEFwcCBmcm9tICcuL0FwcC50c3gnDQoNCmNyZWF0ZVJvb3QoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb3QnKSEpLnJlbmRlcigNCiAgPFN0cmljdE1vZGU+DQogICAgPEFwcCAvPg0KICA8L1N0cmljdE1vZGU+LA0KKQ0K
"@.Trim()


# Write files
Write-AtomicUtf8FromBase64 $appTarget  $b64App
Ok "Wrote: src\App.tsx"

Write-AtomicUtf8FromBase64 $gridTarget $b64Grid
Ok "Wrote: src\components\GridEditor.tsx"

Write-AtomicUtf8FromBase64 $mainTarget $b64Main
Ok "Wrote: src\main.tsx"

# Sanity: ensure no placeholder markers exist
$bad = @()
$bad += Select-String -Path $mainTarget -Pattern "REPLACE_WITH_" -SimpleMatch -ErrorAction SilentlyContinue
$bad += Select-String -Path $appTarget  -Pattern "REPLACE_WITH_" -SimpleMatch -ErrorAction SilentlyContinue
$bad += Select-String -Path $gridTarget -Pattern "REPLACE_WITH_" -SimpleMatch -ErrorAction SilentlyContinue
if ($bad -and $bad.Count -gt 0) {
  Fail "Placeholder markers detected after restore (REPLACE_WITH_). Something is wrong with the payloads."
}

Ok "Restore complete. Refresh the browser (Ctrl+F5)."
